\chapter{LITERATURE REVIEW}\label{chapter2}
Essentially, the results in the range of alternatives to reconstruct cities vary according to the definition of three main phases: (i) sensors and an appropriate measurement of the targets, (ii) processing and classification, according to a desired level of detail and (iii) standardization in well-established formats, such as CityGML \cite{kolbe2005}. The following sections introduce the main works and methodologies in 3D reconstruction of buildings and facades, as well as the spatial and spectral characteristics usually found in these environments, which represent the great challenges of the area.
%According to the guidelines in this study, we aim to semantic label facade features and assign to each of them its corresponding geometry. The facades images are optical, taken on terrestrial close-range platform (phase (i)), and the methodology to extract information (phase (ii)) is determined according to the resolution of the acquired data. %This review section is structured to highlight the challenges of acquiring and extracting information from dynamic scenarios, under an infinite varieties of objects, shapes, and compositions

%Inúmeras fontes de dados, métodos e recursos computacionais são conhecidos na literatura para a reconstrução 3D urbana. Essencialmente, os resultados dessa gama de alternativas variam de acordo com a definição de três principais fases: (i) sensores e adequada medida dos alvos, (ii) processamento e classificação conforme o nível de detalhamento desejável e (iii) transição das características extraídas para formatos de representação digital padronizados. De acordo com as diretrizes deste trabalho, nosso objetivo é a extração de informações em alto nível de detalhamento de fachadas, na qual o grau de detalhes é adquirido por imagens ópticas tomadas em plataformas terrestre de curta-distância (fase (i)), de modo que a metodologia para extração de informações (fase (ii)) seja determinada de acordo com a resolução dos dados adquiridos. Esta seção de revisão é estruturada de forma a destacar os desafios em se adquirir e extrair informações de cenários dinâmicos, com infinitas variedades de objetos e composições e o que tem sido feito até os dias atuais.

\section{Structural data}\label{aquisicao} 
Structural data is considered here as all data that carries with it geometric information of the scene, that after being assigned to a valid coordinate system, can represent geometric values very close to the reality. In the following section, it is presented a summary of current platforms and sensors for acquiring this information.

\subsection{Common alternatives for structural data acquirement}
Urban environments are easily recognized in images by its linear aspects, repetitive patterns, with structures frequently devoid of natural elements, with a wide variety of sizes, shapes, compositions and arrangements. Applications involving studies of these environments equally demands a high resolution acquisition, usually performed on a large or small scale. In Table \ref{tabela-dado-estrutural}, is shown a schema regarding conventional types of structural data acquisition and the maximum Level of Details (LoD) that each configuration could reach in terms of urban objects. The list makes a balance between their respective costs, knowledge required to manage the equipment, accuracy, spatial and spectral resolutions, among others. It is important to note the respective table is a non-exhaustive list, which highlights only common forms of acquirement. Other forms of acquisition, such as civil construction cranes, onboard balloons, helicopters, and any other resources are not listed. 
%Ambientes urbanos são caracterizados por padrões lineares, repetitivos, com estruturas quase sempre destoantes de elementos naturais, com elevada variedade de tamanhos, formas, composições e arranjos. As aplicações envolvendo estudos desses ambientes recorrem igualmente ao sensoriamento remoto de elevada resolução, realizados normalmente em larga ou pequena escala. Apesar deste trabalho abranger apenas a reconstrução 3D pelo sensoriamento remoto de curto alcance, avanços da tecnologia pelo uso de dados de longo alcance são também apresentados. Portanto, de forma a categorizar esta seção, na Tabela \ref{tabela-dado-estrutural} é apresentado esquemas com os tipos convencionais de levantamento de dado estrutural\footnote{A lista destaca as formas comuns de levantamento de dados estruturais por sensoriamento remoto. Portanto, trata-se de uma listagem não exaustiva. Outras formas de aquisição, como a bordo de balões, helicópteros, guindastes e demais recursos não são listados.}, de forma a permutar as diferentes configurações de levantamento com objetivo de classificar seus respectivos custos, níveis máximos de detalhamento dos modelos 3D urbanos (do inglês, \emph{Level of Detail}, \cite{kolbe2005}), conhecimento necessário para o levantamento e objetos urbanos observáveis pela respectiva alternativa de aquisição. 

% Point cloud (PC) is the standard data format to 3D surface reconstruction methods, and can be generated by multiple devices, such as laser scanners (see Section \ref{laser}), Structured-Light cameras (Kinect) \cite{guhring2001, chen2008kinect}, and Photogrammetric Stereo-pair techniques (see Section \ref{Photogrammetry}) \cite{oesau2016}.

\begin{table}[!htp]
    \renewcommand{\arraystretch}{1.4}
    \caption{Maximum Level of Detail (LoD) and quality of 3D urban models according to the acquisition and sensor characteristics.}
    \tiny \centering
    \begin{tabular}{C{0.01cm}C{0.02cm}C{0.6cm}C{0.6cm}L{0.6cm}C{1.3cm}C{0.5cm}C{0.5cm}C{0.5cm}C{0.6cm}C{0.6cm}C{0.5cm}C{0.7cm}C{0.7cm}L{0.7cm}}
        \toprule      
        
        \multicolumn{3}{c}{\multirow{2}{*}{Plataform}}  & \multirow{2}{*}{\parbox{0.7cm}{\centering Spectral region}} & \multirow{2}{*}{\parbox{0.6cm}{\centering Spatial resol.}} & \multirow{2}{*}{\parbox{1.3cm}{\centering Sensor view}} & \multicolumn{3}{c}{Building parts} & \multirow{2}{*}{\parbox{0.6cm}{\centering Max. LoD}} & \multirow{2}{*}{\parbox{0.6cm}{\centering Costs}} & \multirow{2}{*}{Operated} & \multirow{2}{*}{PC} & \multirow{2}{*}{Software} & \multirow{2}{*}{\parbox{0.7cm}{\centering Accuracy}}  \\ \cmidrule{7-9}
            & & & & & & Roof & Facade & Indoor &&&&&& \\ 
            
            \toprule      
            
            \multicolumn{2}{c}{\multirow{3}{*}{\rotatebox[origin=c]{90}{\textbf{\tiny Orbital}}}} & Satellite & Optical &  \textbullet\textbullet\textbullet\color{lightgray}{\textbullet}  & Multi-view & \cellcolor{green!20}\checkmark & $\times$ & $\times$ & \cellcolor{blue!15}LoD2 & \faDollar\faDollar\faDollar & \faGraduationCap & $\star\star\star$ & - &  \textbullet\textbullet\textbullet\color{lightgray}{\textbullet} \\
            
            & & Satellite& Laser & \textbullet\textbullet\textbullet\color{lightgray}{\textbullet} & Multi-view & \cellcolor{green!20}\checkmark & $\times$ & $\times$ & \cellcolor{blue!15}LoD2 & \faDollar\faDollar\faDollar & \faGraduationCap & \checkmark & \faDownload & \textbullet\textbullet\textbullet\color{lightgray}{\textbullet}\\ 
            
            & & Satellite& Hybrid & \textbullet\textbullet\textbullet\color{lightgray}{\textbullet} & Multi-view  & \cellcolor{green!20}\checkmark & $\times$ & $\times$ & \cellcolor{blue!15}LoD2 & \faDollar\faDollar\faDollar & \faGraduationCap & \checkmark & \faDownload & \textbullet\textbullet\textbullet\color{lightgray}{\textbullet} \\ \hline
            
            \multirow{9}{*}{\rotatebox[origin=c]{90}{\textbf{\tiny Aerial (multiple ranges)}}} & \multirow{4}{*}{\rotatebox[origin=c]{90}{\tiny long}} & Airplane & Optical & \textbullet\textbullet\color{lightgray}{\textbullet}\color{lightgray}{\textbullet} & Nadir & \cellcolor{green!20}\checkmark & \cellcolor{yellow!20}\checkmark$~\star$ & $\times$ & \cellcolor{yellow!15}LoD2$\star$ & \faDollar\faDollar\faDollar & \faGraduationCap & $\star\star\star$  & - & \textbullet\textbullet\color{lightgray}{\textbullet}\color{lightgray}{\textbullet}\\
            
            & & Airplane & Laser & \textbullet\textbullet\color{lightgray}{\textbullet}\color{lightgray}{\textbullet} & Nadir & \cellcolor{green!20}\checkmark & \cellcolor{yellow!20}\checkmark$~\star$ & $\times$ & \cellcolor{yellow!15}LoD2$\star$ & \faDollar\faDollar\faDollar & \faGraduationCap & \checkmark & \faDownload & \textbullet\textbullet\color{lightgray}{\textbullet}\color{lightgray}{\textbullet} \\
            
            & & Airplane & Hybrid & \textbullet\textbullet\color{lightgray}{\textbullet}\color{lightgray}{\textbullet} & Multi-view & \cellcolor{green!20}\checkmark & \cellcolor{green!20}\checkmark & $\times$ & \cellcolor{blue!30}LoD3 & \faDollar\faDollar\faDollar & \faGraduationCap & \checkmark & - & \textbullet\textbullet\color{lightgray}{\textbullet}\color{lightgray}{\textbullet} \\
            
            & & Airplane & Optical & \textbullet\textbullet\color{lightgray}{\textbullet}\color{lightgray}{\textbullet} & Multi-view & \cellcolor{green!20}\checkmark & \cellcolor{green!20}\checkmark & $\times$ & \cellcolor{blue!30}LoD3 & \faDollar\faDollar & \faGraduationCap & $\star\star\star$  & - & \textbullet\textbullet\textbullet\color{lightgray}{\textbullet} \\ \hhline{~~-------------}
            
            & \multirow{2}{*}{\parbox{0.1cm}{\rotatebox[origin=c]{90}{\tiny medium}}} & UAV & Optical & \textbullet\textbullet\color{lightgray}{\textbullet}\color{lightgray}{\textbullet} & Multi-view & \cellcolor{green!20}\checkmark & \cellcolor{green!20}\checkmark & $\times$ & \cellcolor{blue!30}LoD3 & \faDollar & \faGraduationCap & $\star\star\star$  & - & \textbullet\textbullet\color{lightgray}{\textbullet}\color{lightgray}{\textbullet} \\
            
            & & UAV & Laser & \textbullet\textbullet\color{lightgray}{\textbullet}\color{lightgray}{\textbullet} & Nadir & \cellcolor{green!20}\checkmark & $\times$ & $\times$ & \cellcolor{blue!15}LoD2 & \faDollar & \faGraduationCap & \checkmark & \faDownload & \textbullet\textbullet\color{lightgray}{\textbullet}\color{lightgray}{\textbullet} \\ 
            
            & & UAV & Hybrid & \textbullet\textbullet\color{lightgray}{\textbullet}\color{lightgray}{\textbullet} & Multi-view & \cellcolor{green!20}\checkmark & \cellcolor{green!20}\checkmark & $\times$ & \cellcolor{blue!30}LoD3 & \faDollar & \faGraduationCap & \checkmark & \faDownload & \textbullet\textbullet\color{lightgray}{\textbullet}\color{lightgray}{\textbullet} \\ \hhline{~~-------------}
            
            & \multirow{2}{*}{\parbox{0.1cm}{\rotatebox[origin=c]{90}{\tiny close}}} & UAV & Optical & \textbullet\textbullet\textbullet\textbullet & Multi-view & \cellcolor{green!20}\checkmark & \cellcolor{green!20}\checkmark & $\times$ & \cellcolor{blue!30}LoD3 & - & \faUser & $\star\star\star$  & - & \textbullet\textbullet\textbullet\textbullet\\
            
            & & UAV & Laser & \textbullet\textbullet\textbullet\textbullet & Multi-view & \cellcolor{green!20}\checkmark & \cellcolor{green!20}\checkmark & $\times$ & \cellcolor{blue!30}LoD3 & \faDollar & \faGraduationCap & \checkmark & \faDownload & \textbullet\textbullet\textbullet\textbullet \\ \hhline{---------------}
            
            \multicolumn{2}{c}{\multirow{5}{*}{\rotatebox[origin=c]{90}{{\textbf{\tiny Terrestrial}}}}} & User & Optical & \textbullet\textbullet\textbullet\textbullet & Multi-view & $\times$ & \cellcolor{yellow!20}\checkmark$~\star\star$ & $\times$ & \cellcolor{blue!30}LoD3 & - & \faUser & $\star\star\star$  & - & \textbullet\textbullet\textbullet\textbullet \\
            
            & & User & Laser & \textbullet\textbullet\textbullet\textbullet  &  Multi-view & $\times$ & \cellcolor{yellow!20}\checkmark$~\star\star$ & $\times$ & \cellcolor{blue!30}LoD3 & \faDollar & \faGraduationCap & \checkmark & \faDownload & \textbullet\textbullet\textbullet\textbullet \\
            
            & & User & Optical & \textbullet\textbullet\textbullet\textbullet & Multi-view & $\times$ & $\times$ & \cellcolor{green!20}\checkmark & \cellcolor{blue!45}LoD4 & - & \faUser & $\star\star\star$  & - & \textbullet\textbullet\textbullet\textbullet \\
            
            & & User & Laser & \textbullet\textbullet\textbullet\textbullet & Multi-view & $\times$ & $\times$ & \cellcolor{green!20}\checkmark & \cellcolor{blue!45}LoD4 & \faDollar & \faGraduationCap & \checkmark & \faDownload & \textbullet\textbullet\textbullet\textbullet \\       
        
        \bottomrule     
    \end{tabular}
    \label{tabela-dado-estrutural} 
    \vspace{0.1cm}
    \begin{flushleft}
        \scriptsize{\textbf{Low}, \textbf{Medium}, \textbf{High}, and \textbf{Very high}, respectively \textbf{(\textbullet\textbullet\textbullet\textbullet)};}\\  \vspace{0.1cm}
        \scriptsize{\textbf{Estimated cost (\faDollar) - 0} to \textbf{3}; \textbf{Specialist (\faGraduationCap)}; \textbf{Common user (\faUser)}; \textbf{Embedded (\faDownload)}.}\\ \vspace{0.15cm}
        \scriptsize{$\star$ Parameter is a function of the sensor's Field of View (FOV). In cases of comprehensive FOVs, it is possible to observe not only the characteristics of roofs, but also of facades, allowing an acquisition of values above LoD2. In cases of FOVs with narrow angles, only the building footprint are observable, consequently, only LoD1 is reachable.}\\
        \scriptsize{$\star\star$ The quality of facades images by terrestrial platforms, depends directly on the height of the building. The imaging of buildings with a height greater than 50 meters, for instance, is affected by the acquisition geometry in its upper part, as well as inner structures.}\\
        \scriptsize{$\star\star\star$ Control points are required.}\\      
    \end{flushleft}
    \FONTE{Author's production.}
\end{table}

% The imaging of urban environments, especially the analysis of facades, are carried out conventionally by orbital, aerial (long, medium and close-range) and terrestrial platforms. Orbital platforms usually have a common goal, the imaging of areas whose spectral and spatial characteristics does not vary often, e.g. forests and oceans. Although in orbit, some sensors have centimeter scales, which places it as one of the alternatives in the urban monitoring. The data are often on private or military domain, when not, with high costs or requiring some kind of pre-processing due to atmospheric attenuation. Observing Table \ref{tabela-dado-estrutural}, it can be seen that the three different orbital configurations have characteristics whose facade observation is possible, but only fine resolutions would allow them to observe the details, which is not always possible by this type of alternative. %When available, both images and laser measurements are rare and inaccessible to the urban context.
%O imageamento do espaço urbano, sobretudo à análise de fachadas, são realizadas convencionalmente por plataformas orbitais, aéreas (de longo, médio e curto alcance) e terrestres. Plataformas orbitais normalmente possuem um objetivo comum, o imageamento de áreas cuja variação espectral e espacial são baixas, p.e. florestas e oceanos. Contudo, ainda que em órbita, alguns sensores possuem capacidade de resolução em escalas centimétricas, o que o coloca como uma das alternativas no monitoramento de ambientes urbanos. Imagens orbitais possuem ainda custos elevados, muitas vezes, sobre domínio privado ou de restrição militar, além de exigirem pré tratamentos devido as inúmeras atenuações do meio atmosférico. Observando a tabela, nota-se que as três diferentes configurações orbitais apresentam características cuja observação de fachadas é possível, porém, somente com resoluções finas permitiriam observar seus detalhes, o que nem sempre é possível por este tipo de alternativa. Quando disponíveis, tanto imagens como medidas laser, são raras e inacessíveis para o contexto urbano.

Aerial platforms, are categorized here into three segments: long, medium and close-range. Surveys whose sensor is onboard airplanes, flying over altitudes around 1,000 meters, are usually considered as long-range surveys. They are, in fact, the most used category over the years, allowing sophisticate imaging, sometimes, with hybrid sensors and configurations that adequately serve the innumerable urban activities. Although many of these products still present high costs, aerial images are still the most widely used in large-scale studies, since it does not require a detailed analysis.
%Plataformas aéreas, por sua vez, são categorizadas aqui em três segmentos: de longo, médio e curto alcance. Levantamentos cujo sensor é acoplado em aeronaves, sobrevoando altitudes em torno de 6.000 metros, são tidos como levantamentos de longo-alcance. São, de fato, a categoria mais utilizada ao longo dos anos, permitindo levantamentos urbanos sofisticados, com sensores de alta capacidade, por vezes híbridos, com configurações que servem adequadamente às inúmeras atividades urbanísticas. Apesar de ainda possuírem custos elevados, as imagens aéreas de alta resolução ainda são as mais adotadas em estudos em larga escala e que não exijam análise detalhada. 

Different imaging requires different costs, efforts and technical infrastructure. The estimated cost shown in Table \ref{tabela-dado-estrutural} is relative and may vary according to area coverage. For example, the cost of orbital laser imaging or high-resolution optical sensors requires a high cost, but may benefit from covering an area whose terrestrial imaging would cover only in parts. The estimated cost in table, therefore, is the absolute cost.

On medium-range, the surveys are normally carried out by fixed-wing Unmanned Aerial Vehicles (UAV) or even by airplanes, whose altitude does not exceed 1,000 meters. In this category, remote data naturally has a gain in resolution, in addition to enabling large-scale imaging, e.g. farms, forests, neighborhoods and others. In facade analysis, only sensors with wide FOV or multi-views gives guarantees of imaging these areas. In Brazil, however, this category still goes through standardization and other bureaucratic procedures for practice, although it is regularly offered by numerous companies (for details, see Section \ref{map-brazil} and \ref{3d-urban-brazil}). 
%De médio alcance, destaca-se os levantamentos realizados normalmente por VANTs de asa fixa ou até mesmo por aeronaves, cuja altitude não ultrapassa os 1.000 metros. Nesta categoria, os dados remotos possuem naturalmente um ganho de resolução, além de possibilitarem o imageamento em larga escala, p.e. fazendas, florestas, bairros e outros. Na análise de fachadas, somente sensores com ângulos de visada (em inglês, \emph{Field of View} - FOV) amplos ou múltiplos sensores (Multi-view) dão garantias de imageamento dessas áreas. No Brasil, entretanto, essa categoria ainda passa por normatização e demais processos burocráticos para a prática, ainda que regularmente oferecida por inúmeras empresas. Diferentes imageamento exigem diferentes custos, esforços e infraestrutura técnica. O custo estimado exibido na Tabela \ref{tabela-dado-estrutural} é relativo e pode variar de acordo abrangência da área. Por exemplo, o custo do imageamento orbital a laser ou por sensores ópticos de alta resolução espacial demandam elevado custo, porém, podem beneficiar abrangem uma área cujo imageamento terrestre não abrangeria. O custo estimado na tabela, portanto, trata-se do custo absoluto.

Finally, close-range surveys consists of small and medium-sized platforms, with target's distance around 200 meters. This specific configuration has gained interest in areas such as Agriculture and Cartography. Close-range devices, such as the UAV (commonly called drones), are usually used for its flexibility, low cost and stability in flying over narrow paths. These qualities, makes this a right alternative to image all the faces of a particular building (e.g. roof, facades, inner gardens). Contrary to the lasers sensors, the UAVs are not only accessible to experts, but also to common users. These small devices are easily purchased on the market for recreational use, but depending on their physical characteristics, they can also be adapted for scientific studies. The handling of laser scanners, however, requires a certain expertise, not just onboard UAVs, but on any other platform. 
%Por fim, os levantamentos de curto alcance, formados por plataformas de pequeno e médio porte, com distância do alvo em torno de 150 metros, têm ganhado distaque nas áreas cartográficas nos últimos anos \cite{REF}.  Plataformas aéreas de curto alcance, como VANTs na categoria Quadricóptero (comumente chamados de drones), são normalmente utilizados justamente pela flexibilidade, baixo custo e estabilidade em voo sobre regiões estreitas. Por conta dessas qualidades, é possível imagear todas as faces de um determinado edifício (p. e. telhado, fachadas, jardins internos). Com excessão dos sensores laser, esse tipo de categoria está não só acessível aos especialistas, como também a usuários comuns. Esses pequenos dispositivos são facilmente adquiridos no mercado para uso recreativo, mas que dependendo de suas características físicas, podem ser também adaptados para estudos científicos. O manuseio de sensores lasers, porém, requer certo \emph{expertise}, não só a bordo de VANT, mas para qualquer outra plataforma. 

The terrestrial platforms complete the range of alternatives in close-range imaging, where three main platforms are adopted: total-station, vehicles or even carried by the own specialist. Although the ground survey does not require the use of an aerial platform, this type of imaging has almost the same properties as the close-range aerial survey. In this category, the images are taken with lateral geometry, at the lower sight level, interesting configuration for facade analysis, but not feasible when the purpose requires the complete coverage of the building. For example, indoor gardens, roof, backyards among other structures are hardly observed.
%As plataformas terrestres completam a gama de alternativas de imageamento de curto alcance, nela, pode-se citar três principais plataformas: estação total, automóveis ou o próprio especialista. Apesar do levantamento terrestre não demandar a utilização de uma plataforma aérea, esse tipo de imageamento possui quase as mesmas propriedades do levantamento aéreo de curto-alcance. Nesta categoria, as imagens são tomadas com geometria lateral, no nível de visada inferior, características interessantes para análise de fachadas, mas inviáveis quando o propósito requer a cobertura completa da edificação. Por exemplo, jardins internos, telhado, jardins de fundo de demais estruturas são dificilmente observadas.

The green color in table, shows the features benefited by the respective configuration, while the yellow determines the dependence of some technical factor. In blue, the maximum LoD reachable by the respective configuration, where the lighters denote non-detailed 3D models, and darkers, detailed ones. In indoor surveys, measures are taken as a complement to lower levels, for instance, LoD2 and LoD3. Of course, the LoD4 model shown would be obtained in addition to an existing model. Measures indoor by itself, do not support the generation of LoD1, LoD2 or LoD3.
%Na tabela, a cor verde realça as feições beneficiadas pelo respectivo levantamento, enquanto que o amarelo determina a dependência de algum fator técnico para que, de fato, a feição seja imageada. As tonalidades em azul, o grau de detalhamento em LoDs, em que as mais claras denotam níveis de pouco detalhamento, e escuras, mais detalhemento. Nos levantamentos terrestres em interiores de edifícios (\emph{indoor}), são adquiridos medidas para complementar níveis inferiores, por exemplo, LoD2 e LoD3. Evidentemente, o modelo em LoD4 mostrado na Tabela \ref{tabela-dado-estrutural}, é obtido em complemento a um modelo já existente. Medidas \emph{indoor} por si só, não dão suporte a geração de LoD1, LoD2 ou LoD3.

\subsection{Other alternatives for structural data}   
The generation of 3D urban models are mainly archived using remote systems, either by active or passive sensors, embedded on a long or close-range acquisition platforms, which is determined often by the application purposes, as presented in the previous section. In addition, complete cities may also be reconstructed from instruments other than those previously presented, for example, by radar (Radio Detection and Ranging), which by its imaging properties, normally allows studies such as terrain variations using SAR (Synthetic Aperture Radar) Interferometry, topography analysis under forest regions, and also cities reconstruction by the technique known as Persistent Scattered Interferometry (PSI) \cite{ferretti2001}, that despite presenting accurate results, it is still expensive technology for requiring systematic radar surveys \cite{schunert2016, schack2012}.

Beyond Photogrammetry, laser, and radar reconstruction techniques, cities can also be generated by procedural models or even manually\footnote{Reconstruction is the process of creating digital representations as close as possible to the measurement in terms of accuracy \cite{musialski2013}. While generation consists of artificially creating realistic representations given a set of rules or procedural mechanisms \cite{muller2006}.}. The concept of virtual and smart cities has become even more common over the years, and has stimulated the continuous development of standalone applications independent of the imaging devices or platform.

\section{Urban environments and their representations}\label{urban-environment}
The different categories of artificial coverage (man-made) constantly change in small fractions of space and time, often altered by humans as well. Understanding the aspects of texture, geometry, material, architectural styles, coverage, among other physical properties helps define the level of abstraction in the method to be developed \cite{vangool2013}. The following sections briefly discuss some of the geometric aspects of buildings and their features, in order to contextualize the main factors for 3D modeling and reconstruction of these environments. For a more comprehensive reading, it is recommended the work of \cite{musialski2013}.
%Em ambientes urbanos, as características tanto espectrais quanto espaciais possuem alto grau de heterogeneidade. As diferentes categorias de cobertura artificial (\emph{man-made}) se alteram constantemente em pequenas frações de espaço, se misturando também à cobertura natural, por vezes, alterada pela ação do homem. Compreender os aspectos de textura, geometria, material, estilos arquitetônicos, cobertura, entre outras características físicas ajudam a definir o nível de abstração do método a ser desenvolvido \cite{vangool2013}. De forma breve, nas seções seguintes são discutidos alguns dos aspectos físicos de edificações e suas feições, de forma a contextualizar os principais fatores para modelagem e reconstrução 3D desses ambientes. Para leitura mais abrangente, recomanda-se ao leitor a referência \cite{musialski2013}.

\subsection{Buildings} 
% Estas características geométricas e espectrais são importantes para a concepção de modelos de extração simples, tal como em \cite{lotte2017a}, 
Regardless the type of imaging, artificial structures are easily distinguished from natural mostly by their linear characteristics. Areas of vegetation are generally identified by their homogeneous texture and typical spectral properties, for example, the numerous vegetation indices, which often allow to separate adequately between vegetation and artificial coverage \cite{gerke2014, demir2012}. However, in some cases, vegetation mixes with urban elements, such as terrace gardens or vertical gardens on balconies, aspects that make it difficult to classify them at the spectral level, but could be easily categorized as being part of a building with the volumetry complement.
%Independente do tipo de imageamento, estruturas artificiais são facilmente distinguidas de estruturas naturais por suas características lineares. Áreas de vegetação são geralmente identificadas pela sua textura heterogênea e de propriedades espectrais típicas, por exemplo, os inúmeros índices de vegetação, que permitem na maioria das vezes separar adequadamente entre cobertura vegetal e artificial \cite{gerke2014, demir2012}. Contudo, em alguns casos, a cobertura vegetal se mistura quase que integralmente à ambientes urbanizados, como é o caso de terraço-jardins ou jardins verticais sobre sacadas, aspectos que dificultam a classificação a nível espectral, mas que poderiam ser facilmente categorizados como para de uma edificações pela complementação da informação volumétrica.

A 3D urban model is a representation of an urban environment with 3D geometries of common urban objects and structures, with buildings as the most prominent feature \cite{billen2014, lancelle2010}. The perception of a building through the human visual system provides innumerable premises on which characteristics should be considered at first. Although the methodology presented in this study does not use spectral or geometrical properties of buildings to extract their features, some of their characteristics are discussed in this section.

A building consists of a cubic element formed by a flat roof with one or more faces \cite{tutzauer2015, haala1999}. Some of them have dome or arched characteristics, and may overlap each other (American type) or present spectral variations due to their composition. In Figure \ref{building-roofs-topologies}, typical roofing examples are illustrated, where it is possible to find from the simplest form (Figure \ref{telhado-a}), to more complex ones (Figure \ref{telhado-e} and \ref{telhado-f}). These characteristics are essential when the extraction of information is carried out essentially by aerial images. 
%A percepção de um edifício por meio do sistema visual humano fornece inúmeras premissas sobre quais características devem ser consideradas em um primeiro momento, por exemplo, estruturas lineares são as que expõem claramente uma estrutura artificial e possivelmente uma região de interesse. Um edifício consiste de um elemento cúbico formado por um telhado de tipo plano ou de uma ou mais águas \cite{tutzauer2015, haala1999}. Além disso, alguns possuem característica de cúpula ou em arcos, podendo ainda se sobreporem (tipo americano) ou apresentar variações espectrais devido a sua composição. Na Figura \ref{telhados}, são ilustrados exemplos típicos de telhados, em que é possível encontrar desde a forma mais simples (Figura \ref{telhado-a}), até formas mais complexas, consistindo em telhados do tipo cúpula (Figura \ref{telhado-f}) ou de formas livres.
\begin{figure}[!htp]
    \centering  
    \caption{Typical representations of roofs and building topologies. (a) Plane roof. (b) One-face roof. (c) Two-faces roof. (d) Four-faces roof. (e) Arched and (f) domed. (g) and (h) Parametric shape. (i) Prismatic. (j) Polyhedral. (l) Curved and (k) free-form.}
    \vspace{6mm}
    \subfigure[]{\label{telhado-a}\includegraphics[width=0.15\textwidth]{\figspath/telhados/telhados-a.pdf}}    
    \subfigure[]{\label{telhado-b}\includegraphics[width=0.15\textwidth]{\figspath/telhados/telhados-b.pdf}} 
    \subfigure[]{\label{telhado-c}\includegraphics[width=0.15\textwidth]{\figspath/telhados/telhados-c.pdf}} 
    \subfigure[]{\label{telhado-d}\includegraphics[width=0.15\textwidth]{\figspath/telhados/telhados-d.pdf}}
    \subfigure[]{\label{telhado-e}\includegraphics[width=0.15\textwidth]{\figspath/telhados/telhados-e.pdf}}
    \subfigure[]{\label{telhado-f}\includegraphics[width=0.15\textwidth]{\figspath/telhados/telhados-f.pdf}} \\
    \subfigure[]{\label{classes-building-a}\includegraphics[width=0.15\textwidth]{\figspath/classes-building/classes-building-a.pdf}}\hspace{0.1cm}
    \subfigure[]{\label{classes-building-b}\includegraphics[width=0.15\textwidth]{\figspath/classes-building/classes-building-b.pdf}}\hspace{0.1cm}
    \subfigure[]{\label{classes-building-c}\includegraphics[width=0.15\textwidth]{\figspath/classes-building/classes-building-c.pdf}}\hspace{0.1cm}
    \subfigure[]{\label{classes-building-d}\includegraphics[width=0.15\textwidth]{\figspath/classes-building/classes-building-d.pdf}}\hspace{0.1cm}
    \subfigure[]{\label{classes-building-e}\includegraphics[width=0.15\textwidth]{\figspath/classes-building/classes-building-e.pdf}}\hspace{0.1cm}
    \subfigure[]{\label{classes-building-f}\includegraphics[width=0.15\textwidth]{\figspath/classes-building/classes-building-f.pdf}}
    \vspace{2mm}
    \legenda{}    
    \label{building-roofs-topologies}   
    \FONTE{Adapted from \citeonline{haala1999} and \citeonline{brenner2000}.}    
\end{figure}

\citeonline{brenner2000} considers six different models of building classes: parametric, combined, prismatic, polyhedral, curved and free-form (Figures \ref{classes-building-a} to \ref{classes-building-f}). Parametric buildings are the simplest forms, usually referring to houses or large sheds, sometimes combining one another (Figure \ref{classes-building-b}), forming large complexes, usually present in industrial regions, in which buildings tend to have a sparse disposition. The prismatic model, frequent in commercial areas, represents buildings whose roof is flat and not necessarily in rectangular form. Polyhedral models expose the geometric details, such as chimneys, eaves, different level of roofs, among others. The curved model, is commonly observed in churches or religious buildings. The other buildings, whose shape does not have a defined pattern, are characterized as free forms, such as the Gherkin building in London, England, or the famous Copan building, in São Paulo, Brazil.
%\citeonline{brenner2000} considera seis diferentes modelos de classes de edificações: paramétricas, combinadas, prismáticas, poliédricas, curvadas e de forma livre (Figura \ref{classes-building}). As edificações paramétricas constituem-se das formas mais simples de edifícios, normalmente referentes a casas ou grande barracões, por vezes, combinando entre si (Figura \ref{classes-building-b}), formando grande complexos, presentes geralmente em regiões industriais, em que os edifícios tendem a apresentar uma disposição mais esparsa. O modelo prismático, frequentes em áreas comerciais, representam os edifícios cujo telhado são planos e não necessariamente em formas retangulares. No modelo poliédrico são reunidas também as feições de chaminés, beirais, possíveis desníveis das faces dos telhados, entre outros. O modelo curvo é comumente observado em igrejas ou edifícios religiosos. As demais construções, cuja forma não apresenta um padrão definido, caracterizam-se como formas livres, como é o caso do edifício Gherkin, em Londres (Inglaterra), ou o famoso edifício Copan, na cidade de São Paulo. 

In real world, buildings are complex structures with different orientations, slopes, shapes, textures and compositions. In addition, tasks involving the extraction of facades features can be impaired by the presence of other objects surrounding, such as cars, lighting poles, pedestrians, and trees \cite{verdie2015, cheng2011}. They are located too close to the walls, which could be treat either as an occluder object or could be simply modeled as being part of the wall.
%No mundo real, edificações, são em sua grande totalidade, estruturas complexas, com diferentes orientações, desníveis, inclinações ou telhados em diferentes texturas e composições. Em aplicações envolvendo a extração de fachadas ou bordas de edifícios, a análise dessas informações torna-se complexa conforme a presença de outros objetos em seu entorno. Por se localizarem próximas às paredes, tais objetos obstruem e dificultam a aplicação dos procedimentos de identificação \cite{verdie2015, cheng2011}.

Besides to the physical properties of buildings, choosing a specific platform and sensor would define, for example, which areas of the building are better imaged than the others. The Figure \ref{building-field-of-view-1} illustrated a close-range acquisition through multiple views. The faces in gray represent the regions not observed by the respective type of acquisition, while red consists the ones that totally imaged. Then, the best configuration for buildings, according to the picture, is the multi-view and terrestrial close-range acquisition (Figure \ref{building-field-of-view-1d}).
\begin{figure}[ht]
    \centering     
    \caption{Building's faces benefited according to the platform. (a) Sensors with geometry to nadir, allow to observe only roofs (some sensors, however, have wide FOVs that allow the analysis of adjacent facades). (b) Sensors with multi-view. A trend in urban mapping by aerial platforms. Oblique images provide wide imaging coverage. (c) Ground sensors on board mobile platforms. They allow the observation of details in high resolution. (d) Urban hybrid imaging by terrestrial sensors and close-range UAVs. They allow the observation of all the faces of buildings.}	 
    \vspace{6mm}
    \subfigure[]{\includegraphics[width=0.24\textwidth]{\figspath/building-field-of-view/building-field-of-view-01.png}}
    \subfigure[]{\includegraphics[width=0.24\textwidth]{\figspath/building-field-of-view/building-field-of-view-02.png}}
    \subfigure[]{\includegraphics[width=0.24\textwidth]{\figspath/building-field-of-view/building-field-of-view-03.png}}
    \subfigure[]{\label{building-field-of-view-1d}\includegraphics[width=0.24\textwidth]{\figspath/building-field-of-view/building-field-of-view-04.png}}
    \includegraphics[width=1\textwidth]{\figspath/building-field-of-view/building-field-of-view.pdf}
    \vspace{2mm}
    \legenda{}    
    \label{building-field-of-view-1}    
    \FONTE{Author's production.}
\end{figure}

% Despite that, a good representation is not restricted only to geometric precision \citeonline{lafarge2015}, but also to:  
% \begin{itemize}
%   \item The complexity of the 3D model, which measures the degree of the output compression;
%   \item The structural guarantees impose global regularities on the geometry and semantics of the output, for example, the standardization of LoDs;
%   \item The visual aspect.
% \end{itemize}
% Segundo \citeonline{lafarge2015}, uma representação com boa qualidade não se restringe à precisão geométrica, mas também por:
%   \begin{itemize}
%    \item A complexidade do modelo, que mede o grau de compactação da saída;
%    \item As garantias estruturais impõe regularidades globais na geometria e semântica da saída, por exemplo, a padronização quanto aos níveis de detalhamento;
%    \item O aspecto visual da representação.
%   \end{itemize}

%Como destacado na Seção \ref{aquisicao}, o método de extração depende exclusivamente do tipo de dado utilizado. A reconstrução de edificações poderia, portanto, ser realizada via imagens aéreas, devido a possibilidade de imageamento amplo e sistemático da cidade. Levantamentos terrestre demandaria uma grande quantidade de armazenamento, ainda que toda a informação em altas resoluções não fossem de fato necessárias. 

% A informação tridimensional, desde o processo de criação ao processo de análise é muito interdisciplinar. São essenciais conhecimentos das mais diversas áreas como desenho técnico, programação e SIG para conseguir criar um modelo urbano tridimensional com informação relevante e útil para análise \cite{stoter2011}.

\subsection{Facade features}\label{facade-features}
The reconstruction of facades fulfills an important segment in inspecting and enforcing urban planning laws. For instance, the mapping of facade features\footnote{Sometimes called openings and referenced here as facade features, such as doors, windows, balconies, gates, etc.} could assist whether a new building can be erected in front or at a given distance from a reference point. \citeonline{burochin2014} analyzed the facade characteristics in order to validate building constructions in accordance to French planning laws. Not only the geometry of buildings is important, but their semantics as well. For the validation of urban plans, it is essential that windows and doors are not only geometrically represented but also explicitly labeled as such \cite{tutzauer2015}.
%A reconstrução de fachadas cumpre um importante segmento na verificação da observâncias às leis de planejamento urbano. A existência de aberturas (janelas e portas) em fachadas determina, por exemplo, se um novo edifício pode ser erguido em frente ou a uma dada distância dessas fachadas \cite{ibam}. \cite{burochin2014} investigam as características de fachadas a fim de identificar e validar as permissões de edificações em relação às leis de planejamento francesa. Não só a geometria das edificações são importantes, como também sua semântica. Para a validação de planos é, por exemplo, essencial que janelas e portas não sejam somente geometricamente representadas, mas também explicitamente rotuladas como tal \cite{tutzauer2015}. 

In this study, we focus only on the details of the building facades and, so far, there is no better way than close-range imaging to observe those details (as exemplified in Figure \ref{building-field-of-view-1}). The campaigns of urban data via terrestrial platforms benefits from the rich information collection, but it is a disadvantage as it does not allow a wide observation of the structure, such as their internal architecture, roof and, depending to their height, the upper part. To illustrate this issue, the diagram in the Figure \ref{building-field-of-view-2} shows each of these non-imaged features. The points $A$ and $D$, the high structures that, due to the limited FOV, might only be partially observed. The point $B$, the roof characteristics, which are hardly observed by terrestrial configurations. Finally, the point $C$, another example of structures that could not be observed by such imaging.
\begin{figure}[!htp]
    \centering     
    \caption{Diagram representing a typical terrestrial campaign. In particular, points A and D denote areas that were negatively affected. High buildings are only partially observed in this type of acquisition. B and C, show details of characteristics that can not be observed either by the type of imaging (only street-side view), or because they are internal structures, such as winter gardens - highlighted in C.}
    \vspace{6mm}
    \includegraphics[width=1\textwidth]{\figspath/building-field-of-view/building-field-of-view-5.pdf}
    \includegraphics[width=1\textwidth]{\figspath/building-field-of-view/building-field-of-view.pdf}
    \vspace{2mm}
    \legenda{} 
    \label{building-field-of-view-2}   
    \FONTE{Author's production.}
\end{figure}

%But as soon as the these features are correctly mapped, other geospatial databases could equally be benefit with merges of information.  
%Porém, estamos interessados em mais detalhes, detalhes presentes nas faces do edifício, denominados aberturas, tais como portas, janelas, sacadas, portões, etc. O levantamento de dados urbanos via plataformas terrestres beneficia com a riqueza de detalhes de fachadas, ao passo que perde ao não permitir a observação \textquotedblleft ampla\textquotedblright das edificações, como sua topologia, arquitetura interna, cobertura e, conforme sua altura, somente parte da fachada (Figura \ref{building-field-of-view-2}). 

The characteristics of doors and windows are pretty much distinguishable, a rectangular geometric pattern, sometimes, occluded by cars, poles, or other objects. The structure's texture uniformity and repeatability of such openings could be verified by the use of radiometric statistics, Histogram of Oriented Gradient (HOG), and Gradient Accumulation Profile (GAP), as in \citeonline{burochin2014}. However, the symmetry between the openings may not favor the respective method, unless the imaging is done by two different platforms or the architectural style be a well defined facade layout. 

In terms of architectural style classification, recent works such as \cite{mathias2011}, \cite{henn2012}, and \cite{weissenberg2014}, has addressed the problem to the first stage in a 3D reconstruction methodology: first, to identify what to deal with - Is it a residential area? Is it industrial? The success of any method depends solely on the distribution, testing and execution of micro tasks, which means in dismembering the global task in smaller tasks, in the end, all micro tasks performed and properly tested, will lead to a more consistent method. In this case, the classification of the facade geometry is a micro task of 3D reconstruction, which even though is not approached in this study, it is important to emphasize the need of this stage as a pre-step in 3D reconstruction issue. 

%As características de aberturas em fachadas, tais como portas e janelas, apresentam padrão geométrico retangular, ora sobre efeito de oclusão (dependendo da orientação e visada do sensor) e baixa resolução espacial, ora não. A uniformidade da textura, estrutura e repetividade que tais aberturas apresentam poderiam ser verificadas pelo uso de estatística radiométrica, histograma de orientação, gradiente e perfil de acúmulo de gradiente, como em \cite{burochin2014}. Entretando, dependendo do estilo arquitetônico, a simetria entre as aberturas, podem não favorecer o respectivo método.

The methodology presented here does not include facade layouts categorization. Instead, it is intended to segment facade features by using Machine Learning (ML) techniques, which has proven they are robust under complex scenarios, such as undefined architectural styles or areas occluded by obstacles. The method considers not only multi-scale analysis, but it is also sensitive towards context, when objects obstructing doors or walls, for example, are easily ignored by the neural model when the obstruction does not cover the facade entirely. %In the following section, it is listed and discussed some of the main works focused on the extraction and reconstruction of urban environments.

\subsection{Architectural styles}\label{architectural-style}
In fact, the number of possibilities to get rid from these scenarios is wide. The range of alternatives, however, can grow even more according to the regions in which it is mapped in the city. Industrial sectors have more differentiated structures than residential or commercial sectors. For example, bigger buildings, few windows, the space in between is also bigger, straight lines geometries for walls, windows, doors, paths, so on. These, however, are more critical because they are sectors of higher traffic, in general, with dynamic structures, greater density that, in the end, make difficult for both to access (at acquisition) and to apply any autonomously method to extract the features.
%De fato, é infinito o número de possibilidades para se contornar nesses cenários. A dimensão de alternativas, no entanto, pode crescer ainda mais conforme as regiões em que se mapeia na cidade. É evidente, portanto, que setores industriais possuam estruturas mais diferenciais que setores residenciais ou comerciais. Estes, no entanto, são mais críticos por se tratar de setores de maior tráfego, estruturas dinâmicas em geral, maior condensamento dos edifícios que, por fim, dificultam tanto o acesso (na aquisição) quanto a própria extração das feições. 

Looking at the architectural styles shown in Figure \ref{facade-layouts}\footnote{Each of them can be access in: Figure \ref{facade-layoutsa}: RueMonge2014 dataset; Figure \ref{facade-layoutsb}: \href{https://imgc.allpostersimages.com/img/print/posters/michael-runkel-neoclassical-architecture-st-petersburg-russia-europe_a-G-10810723-4990827.jpg}{Link}; Figure \ref{facade-layoutsc}: \href{https://www.wondermondo.com/wp-content/uploads/2017/10/Orvieto_cathedral.jpg}{Link}; Figure \ref{facade-layoutsd}: \href{https://www.impressiveinteriordesign.com/wp-content/uploads/2017/12/Warden-St-Residence-by-Mata-Design-Studio-1.jpg}{Link}; Figure \ref{facade-layoutse}: \href{https://static.dezeen.com/uploads/2016/07/mac-niteroi-oscar-niemeyer-rio-de-janeiro_dezeen.jpg}{Link}; Figure \ref{facade-layoutsf}: \href{https://www.verticalgardenpatrickblanc.com/sites/default/files/styles/slideshow/public/medias/image/4-9-20108-42-56500.jpg}{Link}; Figure \ref{facade-layoutsg}: \href{https://media.guiame.com.br/archives/2017/04/11/3673916577-favela-do-cantagalo-no-rio-de-janeiro.jpeg.}{Link}.}, the layout of facade features for these styles differ drastically and, in some cases, would be hardly detected by an automatic method due to the variety of shapes, textures, non-symmetry, and other.
%Observando os estilos arquitetônicos mostrados na Figura 3, pode-se perceber que a disposição das feições de fachadas para estes estilos, diferem drasticamente e, em alguns casos, é dificilmente detectável por um método automático. 
\begin{figure}[!htp]
    \centering     
    \caption{Examples of architectural styles according to different countries and regions in the city. (a) Hausmaniann. (b) Neoclassic. (c) Religious. (d) Modern. (e) Free-form. (f) Vertical-gardens. (g) \emph{Aglomerados subnormais - favelas}.}    
    \subfigure[]{\label{facade-layoutsa}\includegraphics[width=0.169\textwidth]{\dropbox/phd/pics/archs/hausmaniann.jpg}}
    \subfigure[]{\label{facade-layoutsb}\includegraphics[width=0.262\textwidth]{\dropbox/phd/pics/archs/neoclassic.jpg}}    
    \subfigure[]{\label{facade-layoutsc}\includegraphics[width=0.175\textwidth]{\dropbox/phd/pics/archs/religious.png}}
    \subfigure[]{\label{facade-layoutsd}\includegraphics[width=0.3\textwidth]{\dropbox/phd/pics/archs/modern.jpg}}
    \subfigure[]{\label{facade-layoutse}\includegraphics[width=0.35\textwidth]{\dropbox/phd/pics/archs/free-form.png}}
    \subfigure[]{\label{facade-layoutsf}\includegraphics[width=0.33\textwidth]{\dropbox/phd/pics/archs/vertical-garden.png}}
    \subfigure[]{\label{facade-layoutsg}\includegraphics[width=0.3\textwidth]{\dropbox/phd/pics/archs/favela.png}}
    \legenda{} 
    \label{facade-layouts}  
    \FONTE{Author's production. The images was taken from multiple sources in internet, which authors were unknown.}
\end{figure}
 
The Haussmanian style, in Figure \ref{facade-layoutsa}, was the result of a French renovation during the 1870s and represents the predominant style in France, with straight facades, with around 4 to 5 floors, windows often together with balconies, ground floor with the presence of shops, with clear walls and well defined textures. This style, as well as Classicism and Historicism (Figure \ref{facade-layoutsb} and \ref{facade-layoutsc}) also present in many European countries (e.g. Austria, Germany and Spain), is also characterized by the symmetry among the facade features, such that by the layout of the windows and roof, would be possible to estimate the number of floors or amount of internal luminosity of each sector. These styles make up part of the datasets used in this study and in the literature regarding facade feature detection and 3D reconstruction.
%O estilo Haussmaniann, na Figura 3a, foi decorrência de uma renovação françesa durante a década de 1870 e representa o estilo predominante na França, com fachadas retas, de 4 a 5 andares, janelas acompanhadas quase sempre por sacadas, térreo com a presença de lojas e texturas claras e bem definidas. Esse estilo, assim como o Classicismo, Historicismo (Figura3b e Figura3c) presentes também em grande parte de países europeus (Austria, Alemanha e Espanha), é caracterizado também pela simetria entre as feições, tal que pelo identificação das janelas e disposição do telhado, poderia-se estimar o número de andares ou quantidade de luminosidade interna de cada setor. Esses estilos, marcam grande parte dos conjunto de dados utilizados neste trabalho e na literatura quanto a detecção de fachadas e reconstrução 3D.

Figures \ref{facade-layoutsd} to \ref{facade-layoutsg}, on the other hand, present examples of complex architectural geometries that, in terms of autonomous methods of detection and reconstruction, require approaches different from those treated in this study. That is, it is evident that methodologies dealing with the extraction and reconstruction of facade features in Hausmaniann architectures would certainly fail on modern architectures. However, these discussions are difficult to find in the literature that, in certain moments discard this question. Modern architectures have glass in abundance, not only in windows, but also on every surface of their walls. Reflexive surfaces, for example, have features that render the SfM/MVS method useless.
%As Figura3d a 3g, por outro lado, são apresentados exemplos de geometrias arquiteturais complexas que, em termos de métodos autônomos de detecção e reconstrução, requerem abordagens diferentes daquelas tratadas neste estudo. Ou seja, é evidente que metodologias que tratam a extração e reconstrução de feições de fachadas em arquiteturas hausmaniann certamente falhariam sobre arquiteturas modernas. Porém, esses diálogos são dificilmentes encontrados na literatura que, em certos momentos descartam essa questão. Arquiteturas modernas possuem vidros em abundância, não só em janelas, como também em toda superfície de suas paredes. Superfícies reflexivas, por exemplo, possuem características que tornam o método SfM/MVS inútil.

Modern architectures, as in Figure \ref{facade-layoutse}, demarcate another stage of reconstruction. These structures, because they are atypical, do not require automatic methods of reconstruction. They are usually mapped or generated artistically. 

Not only vertical gardens, in Figure \ref{facade-layoutsf}, but also terraced gardens, are becoming common throughout the years. A sustainable practice that tries to recover the space occupied by constructions, but which represent a difficulty in 3D reconstruction. Its texture is confused with the undergrowth or arboreal vegetation which, for methods that use this metric, can be easily confused. Separate one facade from another, only using spectral information, is still a remaining problem. Although works such as the proposed by \citeonline{martinovic2015} still get good separability, the case does not look on real situations, with the presence of any kind of object in front of it, or even under the facade surface. 
%Arquiteturas modernas, como na Figura 3e, demarcam um outro estágio da reconstrução. Essas estruturas, por serem atípicas, não demandam métodos automáticos de reconstrução. Normalmente, são mapeadas ou geradas artisticamente. Não só jardins verticais, na Figura3f, como também jardins sobre terraços, estão tornando-se comuns ao longo dos anos. Uma prática sustentável que tenta recuperar o espaço ocupado por construções, mas que representam uma dificuldade na reconstrução 3D. Sua textura se confunde a vegetação rasteira ou arbórea que, para métodos que utilizam dessa métrica, podem se confundir facilmente. 

Finally, although in Figure \ref{facade-layoutsg} the building does not have a defined architecture, it represents one of the most important structures that, once reconstructed, would greatly benefit 3D mapping in Brazil: the subnormal clusters (in Portuguese, \emph{aglomerados subnormais}), popularly called \textquotedblleft favelas\textquotedblright. These buildings are difficult to access, usually accessible only by walking. By aerial campaigns, they are difficult to map by their spectral characteristics, they do not present any symmetry or pattern. However, they have cultural centers, a large part of the population lives in these areas, it is impossible to measure issues such as sanitation or disasters, attacks on public safety, among others.
%Por fim, arquiteturas indefinidas mas que representam uma das estruturas de maior importância para o mapeamento 3D no Brasil: os aglomerados subnormais, popularmente chamados de favelas. Esses edifícios são de difícil acesso, normalmente, acessíveis apenas caminhando. Por levantamentos aéreos, são difíceis de se mapear por suas características espectrais, não apresentam qualquer simetria ou padrão. No entanto, possuem centros culturais, grande parte da população vive nessas áreas, é impossível mensurar questões como saneamento ou de desastres, os embates quanto a segurança pública, entre outros. 
%Buildings erected out of any civil constructing standards, sometimes in areas of risk, predominant in countries such as Brazil, the \emph{favelas} are consequence of bad income distribution and the housing deficit in the country.

It is necessary to attack smaller causes, and science, as in any area, will merge each of these branches according to their context. Although this study has approached the analysis of different scenarios, including complex ones, it is stated that the 3D reconstruction issue must be treated according to the city or region in which intends to study. Urban environments are extremely dense and complex environments. The conception of a generic model that draws attention to all these disparities is impractical. However, constant observation of these structures narrows down the range of options and encourages future studies. Bringing a natural evolution of such routines.
%É necessário que se ataque causas menores e a ciência, como em qualquer área, unirá cada uma dessas ramificações conforme seu contexto. Embora este estudo ter compreendido a análise de diferentes cenários, incluindo os complexos, fixa-se que o problema da reconstrução 3D deve ser tratado segundo a cidade ou região na qual se deseja estudar. Ambientes urbanos são ambientes extremamente densos e complexos. A concepção de um modelo genérico que extraia e que se atente a todas essas disparidades é impraticável. Porém, a observação constante dessas estruturas estreita a gama de opções e fomenta estudos futuros.

%Although the standardization of the 3D models have not been adopted in this study, the next section brings it up to clarify and to mention the importance of this practice. The format briefly presented, is already adopted by many institutions and companies \cite{biljecki2015a}, and constitutes one of the most important elements in the construction of semantic 3D maps.

\subsection{Standardization - Level of Details (LoDs)}\label{padronização}  
The Open Geospatial Consortium (OGC)\footnote{Association of companies, universities and government agencies for the development of publicly available geospatial interface standards to support interoperable solutions, making geospatial services accessible and useful \cite{ogcstandard}.} with the purpose of standardizing the file formats and quantifying different levels of details of 3D models, established the CityGML language, which provides support for the declaration of physical characteristics and relations between urban elements. 

The language consists of a common semantic model for 3D representations of urban environments. Developed as open-source in XML (eXtensible Markup Language) format, the standard adopts the Geography Markup Language 3 (GML), which represents the international standard for spatial data exchange and coding, idealized by OGC and ISO TC211 \cite{kresse2004}. The standard establishes LoDs consisting of degrees that each 3D object is represented. Objects in the same scene may have higher or lower degrees than others.

LoDs are classified into five levels: first, LoD0, corresponds to the basic level of detail, comprising the planimetric information. The second level, LoD1, corresponds to the 3D representation, simple extrusions, where the buildings are represented not only by its spatial location, but also by its height. At the LoD2 level, simple structural features such as external columns or garages are aggregated. The LoD3, presents more refined external structural details. At this level, texture components and openings are added to their facades, such as doors, windows and balconies. Finally, the LoD4 represents the highest level, with information on the internal structure, usually, acquired by indoor instruments \cite{kolbe2005} (Figure \ref{lods}).
\begin{figure}[!htp]
    \centering     
    \caption{Levels of detail (LoDs) of the standard \emph{CityGML} for 3D buildings models.}
    \vspace{6mm}
    \includegraphics[width=1\textwidth]{\figspath/lods/lods.pdf}    
    \legenda{}
    \label{lods}   
    \FONTE{Adapted from \citeonline{kolbe2005}.}
\end{figure}

Even though there are other standards such as COLLADA (COLLAborative Design Activity) and KML (Keyhole Markup Language), the OCG CityGML standard is particularly the most adopted. CityGML mainly describes the geometry, attributes and semantics of different kinds of 3D urban elements. These can be supplemented with textures or colours in order to give a better impression of their appearance. In addition, semantic information can also be provided, where a description of the geometry, attributes and relationship between different objects can be specified, for example, a building can be decomposed into three parts, or has a safe or a balcony. 

\subsection{Advances in 3D urban reconstruction}\label{monitoring-cities}
The use of high resolution images has been the most effective method for systematic monitoring in all contexts, be it forest, ocean or city. Understanding patterns of changes over time is, however, a task that requires enormous effort when executed manually. In addition, a human interpreter is susceptible to failure and could require prior experience in target perception. As matter of fact, so far few works have been carried out in the field of architectural style identification or facade feature extraction and reconstruction \cite{martinovic2015}. Research has reached a certain level of maturity today, with a variety of technologies for acquisition, high graphics processing, storage and dissemination of information that is available for the automatic operators to make use of. 

The development of intelligent operators for image labeling can be categorized into model-free, model-based, and procedural-models. The first, classical segmentation methods such as Normalized Cuts (NC) \cite{shi2000}, Markov Random Fields (MRF) \cite{kolmogorov2004}, Mean Shift (MS) \cite{comaniciu2002}, Superpixel \cite{achanta2012}, and Active Contours (ACon) \cite{kass}, do not consider the shape of objects or their spectral characteristics, which, in practice, means they always fail in regions where the elements of a same facade do not share the same spectral attributes. Model-based or parametric-model operators, use \emph{a priori} knowledge base, which together with segmentation procedures, provide more consistent results on a given region. However, this knowledge is finite and opens up new possibilities for failures when applied in regions with different characteristics. The third and last, procedural-models like Grammar Shape \cite{stiny1971}, comprise the group of rule-based methods, in which algorithms are applied to the production of geometric forms \cite{teboul2011}.
%Model-free: no assumption on the geometry and the appearance of facade components -> normalized cuts [18], MRFs [10], mean shift [3] and snakes/active contours/level sets [9, 16]
%      Unfortunately, these methods are prone to failure simply because pixels belonging to the same facade element do not necessarily share common visual characteristics
%Model-based: provide a segmentation which is a compromise between the available image support and a prior knowledge 
%      The main assumption of these methods is that the space of solutions can be parameterized in a convenient way. This is far from being sufficient when dealing with building facades, simply because no static parameterization is generic enough to encompass different facade layouts.
%Procedural-models: offer a flexible and powerful tool to account for such variability while being compact and providing a semantic representation of the obtained results

Image segmenters that carry some intelligence usually carry issues with them as well. First, it is necessary to configure and train the model, then, make inferences in what each pixel or region corresponds to. \citeonline{teboul2011} proposed a Grammar-based procedure to segment building facades, where a finite number of architectural styles are considered. The proposed method is able to classify a wide variety of facade layouts and its features using a Tree-based classifier, which improves the detection with only a small percentage of false negatives. 

The Grammar-based approaches, however, are normally formulated by rules which follow common characteristics, such as the sequentiality, which is normally present on \textquotedblleft Manhattan-world\textquotedblright$~$or European styles \cite{wenzel2008}, where the shapes found seem to have lower geometric accuracy since the 3D model is generated, not reconstructed. Still, the outcomes of Grammar-based approaches provide simplicity and perfectly resume the real scene. Other similar works, such as \cite{becker2009}, \cite{nan2010}, \cite{wan2012}, and \cite{boulch2013}, have proposed equivalents solutions to the problem, but still lies on the same deficiencies mentioned above.

In addition to procedural modeling, urban 3D reconstruction incorporates a new class of research, one based on physical (structural) measurements, which comprise measurements by laser scanners and MVS workflows (mainly). As far as it is known, in this category lie the works that present the most consistent methodologies and results, which take into account the geometric accuracy, where the classification of objects can also be explored by their shapes or volume, in addition to their spectral information. 

\citeonline{jampani2015} and \citeonline{gadde2017}, respectively proposed a 2D and 3D segmentation based on Auto-Context (AC) classifier \cite{tu2010}. The facade features are explored by their spectral attributes and then, iteratively refined until results are acceptable. The AC classifier applied in a urban environment is a good choice since it considers the vicinity contribution, which is essential in this particular scenario. The downside, however, is that in this case the AC only succeeds when the feature detection (based on spectral attributes) is good enough, otherwise, it could demand many AC stages to get an acceptable output.

Unlike the approaches mentioned above, there are also lines of research that address the problem of 3D reconstruction over the mesh itself, for this reason, other structural data can be explored, such as LiDAR. \citeonline{lafarge2011, verdie2015, oesau2016} present different contributions, however, with strictly related focuses. It should be noted, therefore, that the approaches in this line of research demand complex geometric operations, for instance, regularities using parallelism, coplanarity or orthogonality. These operations usually have refinement purposes, and also give the 3D modeling an alternative to acquire more consistent and simplified models.
%Diferentemente de abordagens mencionadas acima, há também linhas de pesquisa que tratam o problema da reconstrução sobre o próprio mesh, por essa razão, outros dados estruturais podem ser explorados, como LiDAR. \cite{lafarge2011, verdie2015, oesau2016} apresentam diferentes contribuições, porém, com focos estritamente relacionados. Nota-se, portanto, que as abordagens nesta linha de pesquisa demanda complexas operações de ajustes geométricos, como regularidades de paralelismo, coplanaridade e paralelismo entre faces do mesh, são voltados especificamente para a reconstrução e refinamento da superfície do objeto em questão, dando à modelagem uma alternativa para a aquisição de modelos 3D mais consistentes e simplificados.

Automatic 3D reconstruction from images using SfM/MVS workflows is challenging due to the non-uniformity of the point cloud, and it might contains higher levels of noise when compared to laser scanners. In addition to that, missing data is an unavoidable problem during data acquisition due to occlusions, lighting conditions, and the trajectory planning \cite{li2016}. The papers mentioned in the last paragraph, explore what it is understood as the best methodologies in 3D reconstruction, according to our established goals: exploring the texture first, and then acquiring the semantic 3D model \cite{brostow2008}. 

\citeonline{martinovic2015} proposed an end-to-end facade modeling technique by combining image classification and semi-dense point clouds. As seen in \citeonline{hayko2014} and \citeonline{bodis2017}, the facade features are extracted and semantized by the analysis of its texture, not only, the informations extracted are also associated with the geometry, extracted by the use of SfM. Both approached have motivated this thesis in the sense that facade 2D information can be explored more thoroughly in order to improve its volumetry reconstruction. \citeonline{martinovic2015}, for instance, uses the extracted facade features to analyze the alignment among them, where a simple discontinuity shows the boundaries between different facades. Thereby, it could be used to pre-classify subareas, such as residential, commercial, industrial, and others. \citeonline{sengupta2013}, \citeonline{hayko2014} and \citeonline{bodis2017}, similarly, explored different spectral attributes in order to discriminate the facade features as well as possible. Moreover, the 3D modeling is later supported by these outcomes by performing a complex regularization and refinements over the mesh faces.


% No domínio 3D, tanto Martinovic quanto Gadde, aplicam seus métodos sobre edificações baixas (máximo, 5 andares). A nuvem de pontos baseadas em imagens são satisfatórias para edificações mais elevadas quando adquiridas por aerolevantamentos de curto alcance, tarefa ainda inviável, devido as inúmeras leis para a aquisição de dados nessas áreas e também pela dificuldade operacional

%Em \cite{verdie2015}, a classificação é feita no mesh e não na nuvem de pontos, via MRF com atributos geométricos de planaridade, horizontalidade e elevação. Depois da classificação, são aplicadas regras para o refinamento da classificação. Duas regras são consideradas. 1o: Superfacet rotulados como vegetação adjacente a rotulos de somente telhados é remarcada como telhado. 2o: Superfacet rotuladas como fachada e adjacente a superfacets de vegetação e solo, é remarcada como vegetação, entre outros


\section{3D mapping around the World}\label{map-mundo}
%It is not purpose of this section to present an exhaustive survey of countries and cities that already adopt 3D mapping. Instead, we just give an insight in how the research is heading on. 
Investigating the exact number of cities that actually use 3D urban models as strategic tool in their daily lives can be a difficult task. However, \citeonline{biljecki2015a} presented a consistent review of entities (industry, government agencies, schools and others) that make or made use of 3D maps beyond the visual purpose. Hence, only applications supported by the respective technology are, in fact, listed. Examples of such applications are the visibility analysis for security cameras installation \cite{ming2002, yaagoubi2015}, urban planning \cite{sabri2015, leszek2015}, air quality analysis \cite{amorim2012, janssen2013}, evacuation plans in emergency situations \cite{kwan2005}, urban inventories with cadastral updating \cite{qin2014}, among others.
%Não é objetivo apresentar nesta sessão um levantamento exaustivo de países e cidades que já adotam o mapeamento 3D. Investigar o número exato de cidades que utilizam de fato modelos 3D urbanos como ferramenta estratégica em seu cotidiano pode ser uma tarefa maçante. Para levantamento mais detalhado, recomenda-se a leitura de \cite{biljecki2015}, em que é apresentado uma revisão detalhada de entidades (indústria, órgãos governamentais, escolas e outros) que fazem ou fizeram uso de modelos 3D urbanos além do propósito visual, de modo que são listadas apenas aplicações amparadas, de fato, pelo uso de modelos 3D. Exemplos dessas aplicações são a análise de visibilidade para instalação de câmeras de segurança \cite{ming2002, yaagoubi2015}, planejamento urbano \cite{sabri2015, leszek2015}, análise da qualidade do ar \cite{amorim2012, janssen2013}, planos de evacuação em situações de emergência \cite{kwan2005}, inventários urbanos com pontos de atualização cadastral \cite{qin2014}, entre outros. 

Although the number of cities adopting this tool is uncertain, some of these are known for their technological advances and social development, an important indicator in the implementation of innovative projects. Countries such as the United States, Canada, France, Germany, Switzerland, England, China and Japan are among the leading suppliers of Earth Observation equipment, for example, Leica Geosystems\texttrademark~(Switzerland) laser systems, FARO\texttrademark~(USA), Zoller-Fröhlich\texttrademark~(Germany), RIEGL Laser Measurement Systems\texttrademark~(Austria), Trimble Inc.\texttrademark~(USA), TOPCON\texttrademark~(Japan), and countless optical sensors used in ground and airborne surveys. It is natural, therefore, that these great providers also become reference in conducting research in the sector.
%Apesar do número de cidades que adotam o recurso seja incerto, algumas destas são conhecidas pelos seus avanços tecnológicos e desenvolvimento social, indicativos importantes na implantação de projetos inovativos. Países como Estados Unidos (EUA), Canadá, França, Alemanha, Suíça, Inglaterra, China e Japão estão entre os principais fornecedores de equipamentos de Observação da Terra, por exemplo, sistemas laser Leica Geosystems\texttrademark (Suíça), FARO\texttrademark (EUA), Zoller-Fröhlich\texttrademark (Alemanha), REIGL Laser Measurement Systems\texttrademark (Áustria), Trimble Inc.\texttrademark (EUA), TOPCON\texttrademark (Japão), e incontáveis sensores ópticos utilizados nos levantamentos terrestres e aéreos. É natural, portanto, que estes grandes polos tornam-se também referência na realização de pesquisa no setor.

In Germany, the so-called \textquotedblleft city-models\textquotedblright~were built with the basic purpose of assisting and visualizing simple scenarios or critical situations. At that time, these models did not have sufficient quality for certain analyzes or permanent updating, making use of the old 2D registers for queries. In the end, the 3D models never became part of the register. The concept of urban 3D reconstruction has become, due to demand, a scientific trend in Cartographic, Photogrammetry and Remote Sensing (RS) almost everywhere in the world, especially in the aforementioned countries. 

Naturally, new questions arose. How to merge information already available in 2D databases with the ones in 3D? In certain circumstances, what is the limit on the use of 3D information? When the 2D is already enough and when not? \citeonline{biljecki2015a} argue that all applications that require 2D information can be solved with 3D, but that does not make it a unique feature, but an optional one. For example, \citeonline{kluijver2003} carried out a study of the propagation of noise in urban environments from 2D data. Years later, in \citeonline{stoter2008}, the study was complemented with 3D information, showing considerable improvement in the estimation.
%Na Alemanha, os então chamados \textquotedblleft modelos de cidades\textquotedblright, foram construídos com o objetivo básico de auxiliar e visualizar cenários como este ou, até mesmo, de cenários alternativos em situações críticas. Naquele período, tais modelos não possuíam qualidade suficientes para determinadas análises ou de atualização permanente, fazendo com que se recorresse à antigos cadastros 2D para consultas como localização exata e dimensões das edificações. Por fim, esses modelos 3D nunca se tornavam parte do cadastro. Em meio a necessidade, o conceito de reconstrução 3D urbana tornou-se então uma tendência cientifica nas áreas cartográficas, fotogramétricas e sensoriamento remoto em quase todo o mundo, sobretudo, nos respectivos países. Naturalmente, novas dúvidas surgiram. Como integrar informações já disponíveis em cadastros 2D com informações 3D? Em certas circunstâncias, questiona-se o limite do uso da informação 3D em complemento à 2D \cite{herbert2015}. Em que situações o uso da informação 2D é suficiente e quais somente a 3D é requerida? \cite{biljecki2015} argumentam que todas aplicações que exigem informações 2D podem ser solucionadas com 3D, mas que não a torna um recurso exclusivo, e sim, opcional. Por exemplo, \cite{kluijver2003} realizaram um estudo da propagação de ruídos sonoros em ambientes urbanos a partir de dados 2D. Anos depois, em \cite{stoter2008}, o estudo fora complementado com informações 3D, mostrando considerável melhoria na estimativa. 

% ADICIONAR TRABALHOS - ABORDANDO OUTROS MÉTODOS 
% Also promising and good results by its simplicity, the Shape Grammar (SG) technique has also been used in the modeling of complex structures when joining geometric primitives to the arithmetic operations, that from premises of symmetry, can infer as to the other elements not imaged \cite{becker2009, teboul2011, vangool2013}. In geometry analysis, such as those discussed in \cite{lafarge2015, verdie2015}, have been showing evolution as to the methods of classification in meshes, as well as procedures of refinement and better representability of the 3D model.

\section{3D mapping in Brazil}\label{map-brazil}
In Brazil, the Geographic Service Directorate (in Portuguese, \emph{Diretoria de Serviço Geográfico} (DSG))\footnote{Available at http://www.dsg.eb.mil.br. Accessed \today.} is the unit of the Brazilian Army responsible for establishing Brazilian cartographic standards for the 1: 250,000 and larger scales, which implies standardizing the representation of urban space for basic reference mapping. Recently, the National Commission of Cartography (CONCAR) has put forward the new version of the Technical Specification for Structuring of Vector Geospatial Data (ET-EDGV) \cite{concar2016}, which standardizes reference geoinformation structures from the 1:1000 scale. The data on this scale serve as a basis for the planning and management of the urban geographic Brazilian space. In Brazil, the demand for 3D urban mapping is still low and faces challenges that go beyond its standardization.
%A Diretoria de Serviço Geográfico (DSG)\footnote{Portal da Diretoria de Serviço Geográfico disponível em: http://www.dsg.eb.mil.br. Acesso em: \today.} é a unidade do Exército Brasileiro responsável por estabelecer as normas cartográficas brasileiras para as escalas 1:250.000 e maiores \cite{brasil1967}, o que implica em normatizar a representação do espaço urbano para o mapeamento básico de referência. No contexto do arcabouço normativo da representação do espaço urbano, é possível identificar o Comitê de Normatização do Mapeamento Cadastral (CNMC) da Comissão Nacional de Cartografia (CONCAR), com o objetivo de propor normas para mapeamento cadastral, mas com atuação limitada nos últimos anos. Recentemente, a CONCAR propôs a nova versão da Especificação Técnica para Estruturação dos Dados Geoespaciais Vetoriais (ET-EDGV) \cite{concar2016}, que padroniza as estruturas para geoinformação de referência a partir da escala 1:1000. Os dados nessa escala servem de base para o planejamento e gestão do espaço geográfico urbano. No Brasil, a demanda pelo o mapeamento 3D urbano ainda é baixa e enfrenta desafios que vão além de sua normatização.

As documented in this section, the state-of-art in automatic 3D urban reconstruction covers areas with moderate modeling, whose architectural styles are very specific, streets with large spacing, or symmetry between facade elements, which makes the creation of automatic methods a bit more feasible \cite{vangool2013}. In countries where there is a high density of buildings, such as Brazil, India, or China, this factor is aggravated by the urban geometry. Many of the Brazilian cities do not have a specific style. In suburbs, for example, this factor can prove even more aggravating, where settlement areas or subnormal settlements (in Portuguese, \emph{favelas} -- see Figure \ref{facade-layoutsg}) are all built under these circumstances, with high density and sometimes, erected irregularly or over risky areas, which makes them even more prominent in mapping. 

Initiatives such as the TáNoMapa, by Grupo Cultural AfroReggae\footnote{Available at https://www.afroreggae.org/ta-no-mapa/. Accessed \today.}, together with the North American company Google\texttrademark, consist of mapping hard-to-reach areas such as streets with narrow paths, cliff, among others, by the own local residents. Such areas, in addition to being geometrically complex, require not only cooperation from the government but also from the community who lives there, which by social or security reasons, may require some consent.
%Como documentado neste capítulo, o estado da arte na reconstrução 3D urbana autônoma abrange áreas com modelagem moderada, cujo estilos arquitetônicos são bem específicos, ruas com grande espaçamentos, simetria entre os elementos de fachadas, por conseguinte, a criação de métodos automáticos torna-se factíveis. Em países em que há elevada densidade de edificações, como o Brasil, este fator se agrava devido a geografia e geometria urbana locais. Muitos dos centros urbanos brasileiros não possuem um estilo específico, o que dificulta a modelagem das edificações. Em subúrbios, por exemplo, esse fator é ainda mais agravante. Áreas de assentamentos ou de aglomerados subnormais (favelas), numerosos nessas regiões, possuem densidade elevada, por vezes, erguidos irregularmente ou sobre áreas de risco, o que as colocam ainda mais em evidência no mapeamento 3D. Iniciativas como o projeto TáNoMapa\footnote{Available in: https://www.afroreggae.org/ta-no-mapa/. Access in: \today.}, do Grupo Cultural AfroReggae, em conjunto com a empresa Norte Americana Google\texttrademark, consiste em mapear áreas de difícil acesso, como ruas, vielas, comércio e pontos de interesse das comunidades locais, levantamentos óptico terrestre realizados pelos próprios moradores. Áreas como essas, além de geometricamente complexas, exigem não só coloboração do governo como também das comunidades que, por questões sociais ou de segurança, podem requerer certo consentimento. 

Even though it faces many obstacles, Brazilian urban mapping is moving towards more sophisticated levels. In 2016, the National Civil Aviation Agency (in Portuguese, \emph{Agência Nacional de Aviação Civil} (ANAC)) regulated the use of UAVs for recreational, corporate, commercial or experimental use (Brazilian Civil Aviation Regulation, in Portuguese, \emph{Regulamentos Brasileiros da Aviação Civil} (RBAC), \textquotedblleft portaria\textquotedblright~E~n\textordmasculine~94 \cite{anac-portaria}). The regulation, widely discussed with society, associations, companies and public agencies, establishes limits that still follow the definitions established by other civil aviation entities such as the Federal Aviation Administration (FAA), the Civil Aviation Safety Authority (CASA) and the European Aviation Safety Agency (EASA), regulators from the United States, Australia and the European Union, respectively \cite{anac}. Thus, close-range acquisitions through the use of UAVs became feasible and have fostered research in these fields.
%Ainda que com muitos obstáculos, o mapeamento urbano brasileiro encaminha-se para níveis mais sofisticados. Em 2016, a Agência Nacional de Aviação Civil (ANAC), regulamentou o uso de VANTs para uso recreativo, corporativo, comercial ou experimental (Regulamento Brasileiro de Aviação Civil Especial - RBAC E n\textordmasculine 94 \cite{anac-portaria}). O regulamento, amplamente discutido com a sociedade, associações, empresas e órgãos públicos, determina limites que ainda seguem as definições estabelecidas por outras entidades de aviação civil como \emph{Federal Aviation Administration} (FAA), \emph{Civil Aviation Safety Authority} (CASA) e \emph{European Aviation Safety Agency (EASA)}, reguladores dos Estados Unidos, Austrália e da União Europeia, respectivamente \cite{anac}. Com isso, aquisições de curto alcance pelo uso de VANTs tornam-se viáveis e fomenta a pesquisa nessas áreas.

\section{Geometry extraction}    
\subsection{Structure-from-Motion (SfM)}\label{sfm}
The drawbacks of 3D reconstruction by Photogrammetry are not so many when taking in account its advantages \cite{remondino2005}. In the past decades, close and long-range Photogrammetry have become a widely used tool in 3D city modeling \cite{remondino2006, fraser2009}. Its low costs and availability in remote areas increased its demand, especially in the analysis of such environments. The SfM technique is based on the same physical principles of Stereoscopy, in which a structure can be reconstructed from a series of images taken at small positional variations and overlapping (Figure \ref{sfm-camera}). In conventional Photogrammetry, however, both the position and orientation of the sensor must be known. By the SfM technique, the positional parameters can be estimated. In contrast, point clouds generated by SfM have coordinate system in 3D local reference, or image space, which must later be aligned to the coordinate system of the object \cite{westoby2012}. 
\begin{figure}[!htp]
    \centering 
    \caption{Structure-from-Motion and camera projection. Instead of a single stereo pair, the SfM technique requires multiple, overlapping images as input to feature extraction and 3D reconstruction algorithms.}
    \vspace{6mm}
    \includegraphics[width=1\textwidth]{\figspath/sfm/schema/camera-sfm.png}         
    \vspace{-6mm}
	\legenda{}	
    \label{sfm-camera}       
    \FONTE{Adapted from \citeonline{westoby2012}.}   
\end{figure}

The workflow to obtain the point cloud using SfM begins with the detection of corners in all input images. For every point, a descriptor based on Histogram Oriented Gradient (HOG) is attributed. Then, a set of descriptors from one image are correlate to another one. The ones remaining are called keypoints. The keypoints are used as descriptors in a correspondence analysis among other images, also known as Image-Matching (IM), where pairs are formed according to the level of correlation between each descriptor (i.e., which feature points in several different images depict the same 3D point on the original object). Once the matching has been concluded, the camera orientation and position estimation is started. With the estimated parameters, the matching points now have depth, which together provides detailed structural information of the entire imaged environment. 

The camera position and orientation are estimated iteratively in a process called Bundle Adjustment (BA) \cite{triggs1999}, which in turn, requires a set of overlapping images sharing a set of measurements of point images at \textquotedblleft von Gruber\textquotedblright~positions \cite{agouris2004}. The procedure consists of refining the 3D coordinates based on the number of overlapping images and the intersection of the light rays from each point image and camera projection center. The level of overlap and alignment, therefore, determine the quality of estimation (geometric accuracy) of the point cloud in any SfM methodology \cite{snavely2008, hofer2016}.

Different approaches for SfM pipelines have change the way how to 3D reconstruct cities. As summarized in the Table \ref{tabela-dado-estrutural}, the main contribution for 3D reconstruction by SfM reside in the fact that geometry can be acquired only using optical images, specialists on image acquisitions are no more required since the pictures available on internet could provide sufficient dataset for 3D modeling. For instance, the Bundler \cite{snavely2008} takes an unorganized image collection as input, then it is able to reorganize the collection in a way that each pair correspond to an overlapped image. 

This approach solves, for example, the question of the physical presence of the human operator in the places of interest. Although it only solves the problem mostly at touristic sites, the idea of using images from ordinary users has stimulated areas such as Cartography, Photogrammetry and Remote Sensing since then. Another example, the VarCity project\footnote{Details about the project are available at https://varcity.ethz.ch/. Accessed \today.}\cite{hayko2014}, which uses information from a variety of internet sources and integrates them to reconstruct every scenario in 3D.

Keypoints are simply distinctive points denoting the image identity, areas with optimal characteristics for correlating two images, free of spectral and spatial variations, for example, sharp edges and corners. Fundamental in the areas of Computer Vision, Photogrammetry and Remote Sensing, the concept of corner detection is old and is based on the analysis of images in differential space. The issue, in this case, is how to detect corners in one image and at the same time correlate it with another one, which in turn can present variations in scale, texture or orientation? First, \citeonline{harris1988} proposed to find keypoints using measures based on eigenvalues of smoothed gradients, which allowed the detection of corners independently of rotation, translation and brightness, but not in depth (scale). Then, in 2004, \citeonline{lowe2004} proposed the Scale Invariant Feature Transform (SIFT) method, solving the scale problem and also adding the image matching resolution.

\citeonline{yuan2017} categorizes the matching algorithms in two segments, the ones based only in radiometric information and those based either on radiometric and geometric information. Respectively examples of approaches are the Normalized Cross Correlation (NCC) \cite{gonzalez1992}, Scale Invariant Feature Transform (SIFT) \cite{lowe2004}, and the Distinctive Order Based Self-Similarity (DOBSS) \cite{sedaghat2015}, which stand in the high quality of the images. The second group of algorithms include the Semi-global Matching (SGM) \cite{heiko2008}, Path-based Multi-View Stereos (PMVS) \cite{furukawa2007pvms}, and Multi-photo Geometrically Constrained Matching (MGCM) \cite{zhang2006}. These last algorithms take advantage not only from fine radiometric information, but also from the predetermined geometric information, functions as a supplementary matching constraint.

Among these, SIFT has become the most popular. SIFT is independent of scales, variations of brightness, contrast and orientation. After identified, the matching points are determined in pairs of images according to the correlation of local descriptors in each point. A common descriptor is the use of the HOG, which considers the magnitude and orientation of its neighbors as an identifier in the matching process. In the case of low correlation, these are discarded by the algorithm. The size and quantity of images are also part of the problem in the identification of keypoints, depending, demanding days of processing. More sophisticated procedures have improved SIFT by the use of GPUs (Graphic Processing Unit)\footnote{Electronic circuit dedicated to high-performance graphics processing.}, for example, SiftGPU \cite {wu2007}.

Some of the SfM stages have been improved over the years. Examples of these transformations are the recent use of BA for the iterative adjustment of camera positioning, the use of SiftGPU \cite{wu2007} for computational optimization for image-matching and Multicore Bundle Adjustment (MBA) \cite{wu2011}, the technique Clustering Views for Multi-View Stereo (CMVS) \cite{furukawa2010cmvs}, which the entries are decomposed into smaller processing groups in order to enable parallel processes, PMVS-2 \cite{furukawa2010pmvs2}, an improved version of PMVS, responsible for the automatic reconstruction of only rigid objects, pedestrians, moving cars and others. In Figure \ref{sfm-workflow}, SfM is summarized. The post-processing phase is composed of a dense point cloud refinement, where points can be either simplified (points reducing), filtered (noise removal), or used as input for surface reconstruction (e.g. Poisson \cite{hoppe2008}) and texturing.
\begin{figure}[!htb]
    \centering     
    \caption{Most recent Structure-from-Motion pipelines. From photographs to sparse point-clouds.}    
    \vspace{6mm}
    \includegraphics[width=0.78\textwidth]{\figspath/sfm/flow/sfm-flow-en.pdf}
    \vspace{2mm}
    \legenda{}
    \label{sfm-workflow}       
    \FONTE{Adapted from \citeonline{yuan2017, westoby2012}.}    
\end{figure}


% The term SfM became popular on the reconstruction of 
% MVS assumes known camera calibration, both internal and external (i.e. camera poses), whereas SfM computes camera poses together with reconstructing the environment (the sparse point cloud).

%\cite{hayko2014} exploram a geometria de representações 3D urbanas (\emph{mesh}) para a classificação e construção de sistemas semânticos automáticos a partir de imagens terrestres (\emph{street-side images}). No estudo, é proposto a otimização da detecção de feições de fachadas, com o objetivo principal de reduzir o número de images para aquisição da geometria, consequentemente, a redução do custo computacional na extração de informações. A estratégia de detecção atinge níveis significativos de acurácia considerando a complexidade da cena.

%Algumas das etapas que compõem a técnica SfM foram aperfeiçoadas ao longo dos anos. Exemplos dessas transformações, é o uso recente de BA para o ajuste iterativo do posicionamento das câmeras, o uso do SiftGPU \cite{wu2007} para otimização computacional para correspondência entre imagens (\emph{image-matching}) e MBA (do inglês, \emph{Multicore Bundle Adjustment} - (MBA)) \cite{wu2011}, para suporte computacional à estimativa de parâmetros de câmera, da técnica Agrupamento de Visadas para Imagens Estereo (do inglês, \emph{Clustering Views for Multi-view Stereo} -  (CMVS)) \cite{furukawa2010cmvs}, em que as entradas são decompostas em grupos de processamento menores a fim de viabilizar processos paralelos, do PMVS2 \cite{furukawa2010pmvs2}, responsável pela reconstrução automática somente de objetos rígidos, excluindo, por exemplo, pedestres, carros em movimento e outros. Na Figura \ref{sfm-workflow} é ilustrado o resumo do SfM descrito acima. A fase de pós-processamento é composta pelo refinamento da nuvem de pontos densa, em que os pontos podem ser simplificados (redução do número de pontos), filtrados (remoção de ruídos), ou utilizados como entrada para reconstrução de superfície (e.g. Poisson \cite{hoppe2008}) e texturização.
%\begin{figure}[!htp]
% \centering     
% \includegraphics[width=1\textwidth]{\figspath/sfm/flow/sfm-flow-en.png}     	  
% \caption{Most recent Structure-from-Motion pipelines. From photographs to sparse and dense point-clouds.\\ \textbf{Source.} Adapted from \citeonline{yuan2017, westoby2012}.}
% \label{sfm-workflow}       
%\end{figure}

%A importância no levantamento volumétrico de ambientes urbanos se concentra, principalmente, na possibilidade de construir modelos mais realísticos, agregando informações de volume e ocupação do espaço e com isso analisar as possíveis influências desse efeito. Uma vez extraídas informações precisas quanto à localização e volume de objetos urbanos, estudos como a identificação de ilhas de calor, navegação, turismo, entretenimento, no auxílio ao planejamento urbano, controle de tráfego, insolação de grandes edificações, fiscalização de construções irregulares ou análise de propriedades, validação de planos diretores, entre outras, tornam-se possíveis ao passo que a investigação dos potenciais impactos ao ambiente necessitam não só das características químicas ou biológicas dos objetos, como também de suas informações estruturais.  

%Outra aplicação da representação digital 3D urbana é a possibilidade de simulação de eventos naturais dinâmicos como terremotos, movimentos de massa, expansão urbana, inundações, condições de microclima, circulação do ar entre altos edifícios, estudos de aptidão de sítio para aeroportos, traçado de metrô, identificação de zonas de sombras de telefonia móvel, definição de rota para helicópteros, entre outros que viabilizariam estimar informações confiáveis acerca das consequências e cenários alternativos de ocupação do solo urbano em casos de ocorrências reais desses eventos. Além disso, as informações de volumetria amparam setores como o turismo, ao gerar formas mais realísticas do espaço urbano e, ao mesmo tempo, agregando mídias de acesso para usuários; a arquitetura e urbanismo, ao tornar o uso dessas mídias uma importante ferramenta no setor de planejamento urbano, ao dispor de fóruns \emph{online} de participação popular (denominadas plataformas de planejamento urbano participativo) com o objetivo de fortalecer o entendimento das ações e políticas à população \cite{almeida2007}.

%Coberturas completas de cidades pelo sistema de mapeamento móvel já são oferecidos. Entretanto, são ainda relativamente caras \cite{haala2015}. 

%Realizados em pequena escala, assim como o mapeamento interno de edificações (\emph{indoor}), também realizado por sensores de Luz-Estruturada (\emph{Structured-Light}, conhecido como Kinect) \cite{yue2014}.

% \cite{remondino2006}
%The 3D modelling  of an object can be seen as the complete process that starts from data acquisition and ends with a 3D model. Often 3D modelling is meant only as the process of converting a measured point cloud into a triangulated network (mesh) or textured surface, while it should describe a more complete and general process of object reconstruction. 3-dimensional modelling of objects and scenes is an intensive and long-lasting research problem in the graphic, vision and photogrammetric communities \cite{remondino2006}.

%Nowadays, the generation of 3D models are mainly archieved using remote systems, either by active or passive sensors, embedded on a long or close-range acquision platforms, which is determined often by the application purposes.  

%Laser scanning (LiDAR) and digital imagering are key technologies which sometimes compete with each other, but are quite complementary \cite{fritsch2013}

%As conquistas mais recentes em termos de automatização na geração de modelos tridimensionais urbanos são baseados na integração de duas ou mais fontes de dados \cite{rottensteiner2003a}, como a integração de dados LiDAR e ópticos \cite{steger1998, couloigner2000, tatem2001, dell2001, csatho2003, rottensteiner2003a, rottensteiner2004}, LiDAR e multiespectrais \cite{brunn1997, hug1997, haala1999, vosselman2002} ou LiDAR e InSAR (Interferometria SAR) \cite{stilla2001, stilla2003, dowman2004}. Notoriamente, estudos envolvendo a volumetria de objetos urbanos frequentemente remetem ao uso de dados estruturais.

%Não há na literatura hoje uma metodologia consagrada que determine um roteiro ótimo de geração desses modelos. Nota-se, porém, um padrão de processamento compreendendo dois estágios fundamentais: detecção e reconstrução \cite{rottensteiner2003a, sohn2007, shan2007, beraldin2010}. 

%In a spatial searching for tall objects, for example, possibly results would be trees, antennas, buildings, and other many. However, with a more detailed searching, such as linear edge objects, we could eliminate all those possibilities respect to heterogenous surface, which would lead in a more specific range of alternatives. Eliminate possibilities based on its constraints eitheir its physical characteristics is a common rule and has been used along the years in different ways and fields.



%Nos últimos anos, a tecnologia de imageamento por cameras obliquas tem sido amplamente utilizada na modelagem tridimensional. Com a vantagem de ter mais informações de fachadas, imagens obliquas produzem modelos 3D de edificações ainda mais completos e realísticos \cite{zhu2015}

% Comparisons between range-based and image-based modelling are reported in Böhler and Marbs (2004), Kadobayashi et al. (2004), Böhler (2005) and Remondino et al. (2005)

%O uso de fonte de dados LiDAR e ópticos possuem suas respectivas vantagens e desvantagens para a detecção de objetos. Dados LiDAR fornecem coordenadas tridimensionais e, geralmente, nenhuma infromação espectral*. Dados ópticos, por       outros lado, possuem uma rica informação espectral, o que em regiões urbanas torna-se facilmente uma disvantagem devido a alta variação de propriedades espectrais \cite{demir2012}         

%\cite{leberl2010} compara os dois tipos de imageamento por laser e óptico


%     Esses dispositivos possuem um papel importante em diversas áreas de aplicação, sobretudo, na cartografia, tendo suas principais contribuições no início do século 21 \ref{REF}, quando os primeiros aerolevantamentos sobre cidades foram realizados \ref{REF}. 
% 
%       A amostragem dos dados é função da distância do alvo até o sensor, da orientação do sensor, assim como a geometria da feição \cite{berger2014}
% 
%       A distribuição dos dados é comumente função dos artefatos da aquisição tais como o ruído do sensor, a distância do alvo ou orientação do sensor em relação a superfície \cite{berger2014}
% 
%       A presença de outliers (pontos que encontram longes e isolados da superfície) é devido a artefatos estruturais no processo de aquisição \cite{berger2014}
% 
%       As imperfeições quanto ao registro dos diferentes ranges de aquisição (diferentes faixas de sobrevoo) é devido principalmente ao algoritmo de alinhamento utilizado \cite{berger2014}
% 
%       A ausência de dados é devido ao alcance do sensor, superfícies ou regiões com alta absorção da radiação ou oclusão por objetos no processo de aquisição \cite{berger2014}
% 
%       Como resultado da aplicação de sensores LiDAR terrestre, a nuvem de pontos adquirida tipicamente exibe perda significativa de dados devido a oclusão, além disso, nuvem de pontos irregular \cite{nan2010}
% 
%       Iterative Closest Points (ICP) algoritmos são utilizados para registrar nuvem de pontos adquiridas por diferentes sensores. \cite{pu2009}
% 
%       A reconstrução 3D de edificações a partir de sensores laser normalmente apresenta erros, devido a superamostragem do sensor e limitações quanto a algoritmos de modelagem \cite{pu2009}
% 
%       Imagens ópticas são precárias no quesito de acurácia geométrica, especialmente quando comparada com dados LiDAR, que por sua vez permite adquirir diretamente o espaço de coordenadas dos objetos \cite{yang2016}

% \textbf{a)} Quais e quantas fontes de dados são necessárias para que a reconstrução volumétrica em alto nível de detalhamento seja possível?

% Com a utilização de dados ALS, normalmente a densidade de pontos pode atingir até 12 $p/m^2$, dependendo do sensor utilizado e geometria da aquisição (ângulo de visada  e altitude do sensor). A aquisição por sensor aerotransportado é comumente feita \emph{on-nadir}. No entanto, alguns estudos têm utilizados dados ALS, adquirido \emph{off-nadir} com angulação elevada (câmera oblíquoa) para estudos de fachadas.

% Outra alternativa é a utilizadação de dados terrestres, podendo ser adquiridos por plataformas fixas ou móveis. Dados TLS fornecem altíssimo nível de densidade de pontos. Dependendo do sensor e distância do alvo, a nuvem de pontos pode apresentar desensidade superior a 16 $p/m^2$

% 3. Quais destas fontes estão acessíveis, quais não estão?
% Grande parte devem-se a aquisição privada de informações, principalmente, as que se referem a dados terrestres

%Sensores terrestres podem ser divididos em fixos ou dinâmicos, como mostrado na Figura \ref{sensoreslidar}. No primeiro, as medidas são realizadas em três diferentes modos: (i) Panorâmico (Figura \ref{lidar-terrestrial-view-a}), limitado somente pelo campo de visada de sua própria base; (ii) Híbrido (Figura \ref{lidar-terrestrial-view-b}), neste caso, o ângulo vertical é limitado à uma determinada abertura; e (iii) Câmera (Figura \ref{lidar-terrestrial-view-c}), possuindo limitações em ambos os ângulos, tanto vertical quanto azimutal \cite{staiger2003}. Sensores terrestres dinâmicos são normalmente acoplados em suportes na parte superior dos veículos, possuem o mesmo princípio do escaneamento fixo, acrescido do sistema de posicionamento global GNSS (\emph{Global Navigation Satellite System}) e por uma unidade de medida inercial (\emph{Inertial Measurement Unit} - IMU), que permitem posicionar e orientar o veículo em um determinado referencial geodésico (Figura \ref{lidar-terrestrial-view-d}).

%  Em aplicações envolvendo a extração volumétrica urbana, a demanda por nuvem de pontos LiDAR com densidade alta (acima de 5 $p/m^2$) é pertinente, justamente pela necessidade em discriminar as inúmeras classes possíveis neste ambiente. Tais objetos se inserem frequentemente em contextos complexos, em que são sobrepostos ou estejam muito próximos entre si, por exemplo, copas de árvores com folhagem densas recobrindo telhados ou fachadas, arborizações muito próximas às estruturas artificiais de interesse, como pontes, edificações, entre outros. Portanto, à medida que se diminui a densidade dos pontos, a separabilidade dessas e outras classes torna-se ainda mais trabalhosa.

%Sensores a bordo de plataformas orbitais possuem velocidade e distância do alvo elevadas, aproximadamente $30.000~km/$ e $250.000~m$, respectivamente, que, neste caso, exigem frequências mais altas de operação (\emph{Pulse Repetition Frequency} - PRF), custo elevado, entre outras limitações técnicas que tornam sua utilização em estudos de ambientes urbanos inviável \cite{tack2012}.        

%     In the first part of this section, the principles surrounding the the image-based point cloud generation are introduced. The second and third part are  respectively present a review of approaches about long and close-range image-based building and facades reconstruction.

%In \citeonline{remondino2006}, a image-based 3D modelling systems review is presented. Ten years later, the a comparison regarding this review could 

%photographic interpretation is concerned with the examination of photographs in order to identify objects, and is an essential part of air survey

%Aerial Photogrammetry
%using photographs taken from the air or from space with the camera usually pointing vertically downwards
%the term air survey is used to describe survey techniques using photographs taken from the air or from the space

%Close-range Photogrammetry
%using photographs taken on the ground with the camera usually pointing in a horizontal direction

%Digital imaging has arisen in the 1980s when the first CCD video cameras were used in machine vision applications []. Since 2000, digital airborne camera systems have replaced film-based Photogrammetry. Although first image matching algorighms have been invented in the 1980s their results could not compete with LiDAR point cloud at all. Since 2011 Photogrammetry is having a renaissance by using Semi-Global Matching algorithms \cite{fritsch2013}

% Take form internet -- adapt
% - Photogrammetry is a relatively old technique for measuring and processing lengths and angles in photographs for mapping purposes \ref{slama1980}


%     LoD2 normalmente é suficiente para simulações ou visualizações em pequena e média escala \cite{haala2015}
%     
%     \cite{micusik2014} apresentaram o método SLAM, SfM também baseado em feições lineares, em que é possível reconstruir cenas em larga escala. Bons resultados para ambientes fechados
%     
%     A técnica de image-matching em nuvem de pontos possui problemas sobre objetos reflectivos \cite{tutzauer2015}
%     
%     \cite{zhang2014} propuseram um método sofisticado de SfM baseado em feições lineares
%  
%         \cite{hofer2015} descrevem o princípio do método Line3D. Line3D++ é sua extensão. Line3D++ utiliza LSD \cite{von2010} para obter os segmentos de linha. Somente segmentos longos são considerados, baseando-se em um determinado limiar \cite{hofer2016}
%     
%         Line3D++ utiliza como método SfM o ICG3D \cite{irschara2007}
% 
%         Em \cite{hofer2016}, é apresentado o sistema Line3D++ para geração de modelos 3D urbanos semânticos 
% 
%         SfM: Sparse 3D model (344 imagens, gerou-se 97.699 pontos em 0.75 horas) \cite{lowe2004}
%         PMVS: Semi-dense point cloud (344 imagens, gerou-se 12.156.644 pontos em 11 horas) \cite{furukawa2010}
%         Line3D++: 3D Lines (344 imagens, gerou-se 7.877 pontos em 210 segundos)
% 	
%      Devido a complexidade e diversidade em ambientes urbanos, erros de calibração em cameras podem facilmente serem gerados no processo de image-matching, o que poduziria ruído e nuvem de pontos imprecisa comparada a uma nuvem de pontos LiDAR \cite{zhu2015} 

%Informações 3D não são facilmente obtidas por imagens MVS (Multi-View Stereo) devido a necessidade de calibração e registro de imagens \cite{lafarge2015}

%Atualmente, graças a disponibilidade de softwares livres ou às sofisticadas ferramentas de processamento, até mesmo usuários não especialistas conseguem manusear e gerar modelos 3D \cite{hofer2016}

%Proposes an efficient approach for building compact, edge-preserving, view-centric triangle meshes from either dense or sparse depth data, with a focus on modeling architecture in large-scale urban scenes

% Definition
%Multi-View Stereo (MVS) algorithms reconstruct a surface (or volume) from multiple calibrated images, where the calibration is typically provided automatically via SfM.
%     \subsection{Diferenças LiDAR e Stereo-images}
%     http://geoawesomeness.com/drone-lidar-or-Photogrammetry-everything-your-need-to-know/?platform=hootsuite

%Some recent MVS algorithms developed in Simultaneous Localization and Mapping (SLAM) frameworks can run in real-time on the GPU [1], CPU [2], or on top-grade mobile phones [3]
%  \textbf{a)} Newcombe, R.A. , Davison, A.J. , 2010. Live dense reconstruction with a single moving camera. CVPR. 
%	Pizzoli, M. , Forster, C. , Scaramuzza, D. , 2014. REMODE: Probabilistic, monocular dense reconstruction in real time. ICRA
%Newcombe, R. A. , Lovegrove, S. J. , Davison, A. J. , 201a) DTAM: dense tracking and mapping in real-time. ICCV .
%      2. Geiger, A. , Ziegler, J. , Stiller, C. , 201a) Stereoscan: Dense 3D reconstruction in realtime. Intelligent Vehicles Symposium (IV) .
%      3. Tanskanen, P. , Kolev, K. , Meier, L. , Camposeco, F. , Saurer, O. , Pollefeys, M. , 2013. Live metric 3D reconstruction on mobile phones. In: ICCV, pp. 6572 .


\section{Deep Learning (DL)}\label{deep-learning}
In terms of image labeling, years of advances have brought what is now considered a gold-standard in segmentation and classification: the use of DL. The technology is the new way to solve old problems in Remote Sensing \cite{audebert2017}. It is one of the branches of ML that allows computational models with multiple processing layers to learn representations in multiple levels of abstraction. The term \textquotedblleft deep\textquotedblright, refers to the amount of processing layers that is usually used during training. 
%Em termos de detecção automática de objetos, anos de avanços trouxeram o que hoje é considerado o gold-stardard na segmentação e classificação de imagens: a utilização de Deep-Learning . \emph{Deep Learning} é uma nova forma de resolver velhos problemas em Sensoriamento Remoto \cite{audebert2017}. É um dos ramos do Aprendizado de Máquina (\emph{Machine Learning} - ML) que permite modelos computacionais que compõem múltiplas camadas de processamento a aprenderem representações de dados com múltiplos níveis de abstração. O termo \emph{deep}, refere-se portanto à quantidade de camadas de processamento. 

\citeonline{mitchell1997} succinctly defines the learning from a ML as: \textquotedblleft A computer program learns from a given experience $E$ relative to application classes $T$ with a performance $P$, if the performance on task $T$ is better than in $E$ \textquotedblright. Widely categorized as unsupervised or supervised, ML is defined by the type of experience that can be applied during the learning process. Shortly, unsupervised learning does not require samples during the training process (learning occurs with the dataset itself), while the supervised assume its behavior according to a reference set. \citeonline{lecun2015} believe that unsupervised learning will become far more important in the longer term, since machine learning tends to look more like human learning, which in turn has its learning largely unsupervised: \textquotedblleft \textit{they discover the structure of the world by observing it, not by being told the name of every object}\textquotedblright.
%\citeonline{mitchell1997} define sucintamente aprendizado de máquina como: \textquotedblleft Um programa de computador aprende a partir de uma determinada experiência $E$ relativa à classes de aplicações $T$ com um desempenho $P$, se seu desempenho sobre as tarefas $T$, tal como medido em $P$, for melhor em $E$\textquotedblright.  Amplamente categorizado como não-supervisionado ou supervisionado, o aprendizado de máquina é definido pelo tipo de experiência que pode ser aplicada durante o processo de aprendizagem. Em suma, o aprendizado não-supervisionado não requer exemplos durante o processo de treinamento (aprendizado ocorre com o próprio conjunto de dados), enquanto o segundo, assume seu comportamento conforme o conjunto referência a ser apresentado \cite{goodfellow2016}.

These models have made remarkable advances in the state-of-art of pattern recognition, speech recognition, detection of objects, faces, and others. Shortly, DL architectures are trained to recognize structures in a massive amount of data using, for example, supervised learning with the concept of backpropagation\footnote{Backpropagation is a method commonly used in ML to calculate the error contribution of each neuron after each training iteration.}, where the model is indicated the proportion of what must be changed in each of its layers until \textquotedblleft learning\textquotedblright~occurs (error decay) \cite{lecun2015}.
%\emph{Deep Learning} é uma nova forma de resolver velhos problemas em Sensoriamento Remoto \cite{audebert2017}. É um dos ramos do Aprendizado de Máquina (\emph{Machine Learning} - ML) que permite modelos computacionais que compõem múltiplas camadas de processamento a aprenderem representações de dados com múltiplos níveis de abstração. O termo \emph{deep}, refere-se portanto à quantidade de camadas de processamento. Esses modelos permitiram avanços notáveis no estado-da-arte do reconhecimento de padrões, de fala, na detecção de objetos, faces e muitos outros domínios. Em suma, DLs são treinadas a reconhecer estruturas em uma quantidade massiva de dados utilizando, por exemplo, aprendizagem supervisionada com o conceito de retropropagação de erros (\emph{backpropagation})\footnote{\emph{Backpropagation} é método comumente utilizado em RNA para calcular a contribuição de erro de cada neurônio após cada iteração de treinamento.}, em que é indicado ao modelo a proporção do que deve ser alterado em cada uma de suas camadas até que o \textquotedblleft aprendizado\textquotedblright ocorra (diminuição do erro) \cite{lecun2015}. 

%A aprendizagem não-supervisionada, também teve efeito catalisador no conceito DL, mas desde então, tem sido ofuscada pelos êxitos da aprendizagem supervisionada. A longo prazo, \citeonline{lecun2015} acreditam que a aprendizagem não-supervisionada tornará-se muito mais importante devido a sua capacidade em moldar-se a natureza. A aprendizagem humana e animal é em grande parte não-supervisionada, em que a aprendizagem ocorre ao descobrir-se a estrutura do mundo, observando-a, não necessariamente informando o nome de cada objeto. 
Unsupervised learning had a catalystic effect in reviving interest in DL, since then, it has been overshadowed by the successes of supervised learning. \citeonline{lecun2015}, on the other hand, believes that unsupervised learning will become far more important in the longer term, as the technological tendency is to get closer and closer to human behavior. %Human and animal learning is largely unsupervised: they discover the structure of the world by observing it, not by being told the name of every object.

\subsection{Convolutional Neural Network (CNN)}\label{cnn-sect}
In 1943, the first Artificial Neural Network (ANN) appeared \cite{pitts1943}. With only a few connections, the authors were able to demonstrate how a computer could simulate the human learning process. In 1968, \cite{hubel1968} proposed an explanation for the way in which mammals visually perceive the world using a layered architecture of neurons in their brain. Then, in 1989, a neural model started to get attention not only because of its results, but also for its similarities with the biological visual system, with processing and sensation modules. 

\citeonline{lecun1989} presented a sophisticated neural model to recognize handwritten characters, named first LeNet, then later, Convolutional Neural Network (CNN). Precisely, the reason for this name is due the successive mathematical operations of image convolutions. Since then, many engineers have been inspired by the development of similar algorithms for pattern recognition in Computer Vision. Different models have emerged and contributed to the evolved state of neural networks in the present days. In Figure \ref{cnn-arch}, the LeNet neural model, developed by Yann Lecun in 1989 \cite{lecun1989}.
%Em 1943 surgia a primeira Rede Neural Artificial (RNA) \cite{pitts1943}. Apenas com poucas conexões, os autores demonstraram como simular computacionalmente o aprendizado humano. Em 1968, \cite{hubel1968} propuseram hipóteses de como os mamíferos percebiam visualmente o ambiente ao seu redor baseando-se em arquitetura de camadas de neurônios. Então, em 1989, um modelo neural chamou a atenção não só pelos seus resultados em ambientes complexos, mas também por suas semelhanças com o sistema visual biológico, com módulos de processamento e sensação. \cite{lecun1989} apresentaram um sofisticado modelo neural para o reconhecimento de caracteres escritos manualmente, nomeada Rede Neural Convolucional (CNN) precisamente pelas sucessivas operações matemáticas de convolução aplicada à imagem. Desde então, uma legião de engenheiros inspiraram-se no desenvolvimento de algoritmos semelhantes para o reconhecimento de padrões em Visão de Computacional. Diferentes modelos surgiram e contribuíram para o estado evoluído das redes neurais nos dias atuais.
\begin{figure}[!htp]
    \centering     
    \caption{LeNet: The first version of a CNN, projected by Yann Lecun in 1989.}
    \vspace{6mm}
    \includegraphics[width=1\textwidth]{\figspath/cnn/lenet/leNet_1.pdf}
    \includegraphics[width=1\textwidth]{\figspath/cnn/lenet/leNet_2.pdf}
    \legenda{}    
    \label{cnn-arch}   
    \FONTE{Adapted from \citeonline{lecun1989}.}
\end{figure}

The CNN is structured in stages, the first ones are composed of two types of layers: convolution and pooling (in the figure, in blue and red). Units in a convolution layer are organized into feature maps or filters, where each unit is connected to a window (also called patch $C_x$ - details in the bottom figure) in the feature map of the previous layer. The connection between the window and the feature map is given by weights ($w$) and biases ($b$). The weighted sum of the convolution operations is followed by a nonlinear activation function, called Rectified Linear Unit (ReLU). For many years, activations in neural networks were composed of smoother functions, such as the $tanh(x)$ or $1/(1+e^{-x})$ sigmoids, but recent study has shown ReLU to be faster on learning in multilayered architectures \cite{lecun2015}. The fully-connected layer corresponds to a traditional Multi-Layer Perceptron (MLP), with hidden layer and logistic regression. Then, the input to the MLP layer is the set of all features maps at the previous one.

CNN have made advances in image, video, speech and audio analysis, while Recurrent Networks (RR) have supported the path to sequential data such as text and speech \cite{lecun2015}. It was designed to recognize visual patterns directly from pixel images with minimal preprocessing. Due to convolution over images and its reduced versions (downsampling), they can recognize patterns with extreme variability, scales, and with robustness to distortions and simple geometric transformations such as handwritten characters. 

%Due its robustness on classify and segment images around complex environments, CNN has been a trend in the variety of Computer Vision applications. Not only, the approach has also been a gold-standard on face recognition \cite{lawrence1997}, speech recognition \cite{abdel2013}, natural language \cite{kalchbrenner2014, ciresan2011}, and others. In image analysis, not the first but the boom of CNNs for images could be nominated to AlexNet approach \cite{krizhevsky2012}, when this technique start to be exhaustive tested, and became a charming and fast way to classify objects on the scene.

Because of its robustness in image classification and segmentation over complex environments, CNN has been a trend in many Computer Vision applications. For example, the approach is considered gold-standard in applications such as face recognition \cite{lawrence1997}, speech recognition \cite{abdel2013}, natural language \cite{kalchbrenner2014, ciresan2011}, and others. In image analysis, not the first, but the reference on the use of CNNs for images can be named to the model AlexNet \cite{krizhevsky2012}, when the technique began to be exhaustively tested and became a practical and fast way in object classification. 

With the success on ordinary image classification, neural models came to be used also in numerous applications involving Remote Sensing \cite{zhu2017}. Examples of that are the analysis of orbital images \cite{castelluccio2015, marmanis2016}, radar \cite{chen2014sar, chen2016, sun2012}, hyperspectral \cite{chen2014, romero2014} and in urban 3D reconstruction \cite{hane2013, blaha2016, blaha2016towards}. Although not focused specifically on the analysis of facades, excellent results have been reported in the classification of urban elements through the use of DL. 

An example of this evolution can be observed in the annual PASCAL VOC \cite{pascalvoc} challenge that, brings together experts to solve classical tasks in Computer Vision and related areas. The applications range from recognition \cite{krizhevsky2012} to environment understanding, where the analysis is focused on the relationship between the object itself. Therefore, certain constraints could be imposed to the relation, for example, between a pedestrian and street or vehicles in applications involving self-driving \cite{segnet, teichmann2016}, such that a distance and speed constraints could be imposed between these detected objects. \citeonline{lettry2017} used CNN to detect repeating features in rectified facade images, wherein the repeated patterns are verified on a projected grid, then, it is used as a device to detect those regular characteristics and reconstruct the scene. 

%Convolutional neural networks (CNNs) are the current state-of-the-art model architecture for image classification tasks. CNNs apply a series of filters to the raw pixel data of an image to extract and learn higher-level features, which the model can then use for classification. CNNs contains three components:
%Convolutional layers, which apply a specified number of convolution filters to the image. For each subregion, the layer performs a set of mathematical operations to produce a single value in the output feature map. Convolutional layers then typically apply a ReLU activation function to the output to introduce nonlinearities into the model.
%Pooling layers, which downsample the image data extracted by the convolutional layers to reduce the dimensionality of the feature map in order to decrease processing time. A commonly used pooling algorithm is max pooling, which extracts subregions of the feature map (e.g., 2x2-pixel tiles), keeps their maximum value, and discards all other values.
%Dense (fully connected) layers, which perform classification on the features extracted by the convolutional layers and downsampled by the pooling layers. In a dense layer, every node in the layer is connected to every node in the preceding layer.
\subsubsection{Autoencoder}
How humans perceive the environment around them is still a topic of recurrent research and, so far, not fully understood. The human visual system consists basically of two processes: radiation capturing and visual perception. The first, numerous chemical and optical processes take place in the eyes of the observer. All visible radiation captured is transformed into synaptic signals by photo-receptor cells, called cones and rods. From this point, these signals representing this lapse moment are then directed to specific regions of the brain, which through chemical reactions and many others to be understood, allow to connect these signals to the perceptual neural senses, which then allows to see and perceive the environment, completing the basic mechanism of the human visual system.
%Como os humanos percebem o ambiente ao seu redor é ainda tema de pesquisa recorrente e, até o momento, não totalmente compreendido. O sistema visual humano consiste basicamente de dois processos: a captura e a percepção visual. Na primeira, inúmeros processos químicos e ópticos acontecem nos olhos do observador. Toda radiação visível captada é transformada em sinais sinápticos por células fotoreceptoras, denominadas cones e bastonetes. A partir deste ponto, esses sinais que representam essa imagem são então direcionados a regiões específicas do cérebro, que por reações químicas e outras muitas a serem compreendidas, permitem conectar tais sinais à sentidos neurais perceptivos, que então possibilita ver e perceber o ambiente e seu entorno. Completando o mecanismo básico do sistema visual humano e similares.
%How humans perceive the environment is still a subject of research and not fully understood so far. However, some new advances has shown remarkable results. The human vision system consists basically of two steps, the capture and visual perception. In the first, all radiation on its field view is captured by the visual system, which by numerous chemical and optical procedures process this radiation in signals, which is pretty much the description of that environment; from this point on, these signals representing this environment are then directed to specific regions of the brain, which by chemical reactions and many others, allows to connect these signals to the perceptive senses, completing the basic mechanism of the human visual system. 

CNNs can assume different processing mechanisms, different numbers of layers and how they are connected. The architecture called Autoencoders or encoder-decoder \cite{segnet, teichmann2016}, presents similarity not only in architecture but also in the behavior of human visual system. As described in the previous paragraph, two basic mechanisms can be noticed in the biological system: one for processing the radiation in synaptic signals by photo-receptor neurons; and another, for environmental perception, mainly performed by the visual cortex. 
%CNNs podem assumir mecanismos diferentes de processamento, números diferentes de camadas e como são conectadas. A arquitetura denominada \emph{autoencoders} ou \emph{encoder-decoder} \cite{segnet, teichmann2016}, apresenta  semelhança não só na arquitetura como também no comportamento do sistema visual humano. Em suma, dois mecanismos básicos podem ser notado no sistema biológico: um para processamento da radiação em sinais sinápticos por neurônios fotoreceptores; e outro, para percepção do ambiente, cortex visual. Analogamente, o mecanismo \emph{encoder} e \emph{decoder} simula respectivamente este processo. 

Similarly, the encoder and decoder mechanism respectively simulate this two process. First, the input image is subjected to numerous convolution and pooling operations. For each pooling, the downsampling occurs, where the image resolution is reduced and passed on as input to the subsequent convolution layer. Each convolutional layer has a set of convolutional filters, also called filter bank, each of these looks for specific features on image, such as horizontal lines, vertical, curved ones, faces, cars, and others. Consequently, the filter bank learns different patterns in different scales, orientation and location (functions similar to those of the biological lens and retina) as it goes down on deep layers. 

Signals in small dimensions are then transmitted to the decoder, which from three convolution layers performs the upsampling, which is simply deconvolutional operations, the transformation of signals from smaller resolutions to larger resolutions. The result of this transformation is therefore a map of \textquotedblleft perceptions\textquotedblright, the segmented image (Figure \ref{encoder-decoder-arch}). 
%A primeira, são realizadas sucessivos processos convolutivos na imagem de entrada. Para cada subregião, a camada realiza um conjunto de operações matemáticas para produzir um simples valor no mapa de feições, geralmente, funções de ativação do tipo ReLU (do inglês, \emph{Rectified Linear Unit}) são aplicadas à saída para introduzir não-linearidades ao modelo. As camadas de \emph{pooling} são dispostas sempre ao fim das camadas convolucionais. Seu papel é reduzir a dimensionalidade (\emph{downsample}) do mapa de feições, i.e. reduzir a imagem de forma a diminuir o tempo de processamento. A regra básica de redução é a utilização do \emph{max-pooling}, que extrai sub-regiões do mapa de feições (e.g em janelas de 2$\times$2 \emph{pixels}) e mantém somente seu valor máximo, descartando todos os outros. Por fim, a camada densa realiza a classificação das feições extraídas pelas camadas convolucionais e de \emph{pooling}, tal que cada nó na camada densa é conectado aos nós na camada anterior (Figura \ref{encoder-decoder-arch}).

%No primeiro, a imagem de entrada é submetida a inúmeros processos de convolução e \emph{pooling}. A cada \emph{pooling}, o processo de \emph{downsampling} ocorre, em que a resolução da imagem é reduzida de forma a ser a entrada para as camadas convolucionais posteriores. Consequentemente, o banco de filtros aprendem diferentes padrões em diferentes escala, orientação e localização (funções semelhantes aos do cristalino e retina biológicos). Os sinais em dimensões reduzidas são então transmitidos ao \emph{decoder} (cortex visual), que a partir de três camadas convolutivas realiza o \emph{upsampling}, e.g. a transformação dos sinais de resoluções menores para resoluções maiores. O resultado dessa transformação é, portanto, um mapa de \textquotedblleft percepções\textquotedblright das classes (imagem segmentada).
\begin{figure}[!htp]
    \centering     
    \caption{Autoencoder architecture to segment images.}
    \vspace{6mm}
    \includegraphics[width=1\textwidth]{\figspath/cnn/flow/cnn-flow.pdf}
    \legenda{}
    \vspace{2mm}
    \FONTE{Adapted from \citeonline{segnet}.}      
    \label{encoder-decoder-arch}
\end{figure} 

%Analogously, CNNs have two basic processing mechanisms, called encoders and decoders. The first, responsible for processing the signals (eyes), so that the image is passed through multiple convolution and pooling layers, and different convolution filters learn to detect different patterns in images (lens, focus and retina). In this process, the features of "interest" at the moment of seeing something are highlighted by the eyes, so that at the moment when viewing something only part of the scene is actually captured. Then these signals are transmitted to the decoder (visual cortex), which from three convoluted layers transposed to perform the up-sampling procedure, which in short, turn the signals into smaller resolutions for larger resolutions. The result of this transformation is a map of "perceptions" (segmented image) of the respective input.

Another feature of these systems and also idealized observing human behavior is the way humans perceive space and objects in their environment. In a lapse of time, innumerable processes are triggered instantly in the brain. In one of these, it is possible to note the human capacity to identify distinct features of all the rest. It is like the human visual system \textquotedblleft would not worry\textquotedblright~at capturing all the information on that environment, but rather, only those that might be interesting. Permanently, the human eyes scan the environment in very fast movements, process called Saccade \cite{ko2016, pirkl2016}. These very fast movements, allow the eyes to capture fractions of images step-by-step. In the Figure \ref{feature-imagem-trajeto-retina}, for instance, the features highlighted by the CNN and the path of the iris when exposing a random image is accurately close.
\begin{figure}[!htp]
 \centering     
 \subfigure[]{\label{feature-a}\includegraphics[width=0.48\textwidth]{\figspath/cnn/feature/feature-a.png}
 \includegraphics[width=0.48\textwidth]{\figspath/cnn/feature/feature-b.png}}\\
 \subfigure[]{\label{feature-b}\includegraphics[width=0.475\textwidth]{\figspath/eyetracking/eyetracking.png}
 \includegraphics[width=0.50\textwidth]{\figspath/eyetracking/eye-tracking-2.png}}
 \caption{Analogy to the computational neural system and biological. (a) Output of a Recurrent Neural Network (RNR), a special type of \emph{deep} network. The network is trained to translate high levels of representations into texts. In the figure, the network's ability to focus its attention on specific sections of the image; (b) Eye-tracking device and the capture (gray points) of eyeball movements - Saccade effect.}
 \label{feature-imagem-trajeto-retina}
 \FONTE{Adapted from \citeonline{lecun2015, pirkl2016, dalmaijer2014}.}             
\end{figure} 

The semantic segmentation of images by the use of neural networks has gained adherents in a wide range of applications, ranging from the recognition of objects of different natures \cite{krizhevsky2012}, as well as the understanding of the environment, in which the analysis is also applied on the relation between the objects themselves. Thus, certain constraints could be easily applied, for example, a pedestrian with the object street or automobiles in an application involving autonomous driving \cite{segnet, teichmann2016, lettry2017}. As emphasized by \citeonline{zhu2017}, Remote Sensing data represent a new challenge for DL. Their imaging nature can often be differentiated. For example, optical, laser and radar data provide different representations, which would require analysis that has not yet been so explored with the use of DL. %Remote Sensing data is georeferenced, images from internet are usually free of location metadata. In this case, DL could correlate specific facades from internet to a location in a RS data, supporting Security agencies. %Data from SR carries with it an enormous amount of information, physical and biochemical measurements that, in integration with DL, could improve prediction algorithms or emulators, as well as numerous other applications.
%Inspirando-se na segmentação semântica e classificação, os então modelos neurais \textquotedblleft inteligentes\textquotedblright passaram, então, a ser utilizados em inúmeras aplicações em SR \cite{zhu2017}, como na análise imagens ópticas orbitais \cite{castelluccio2015, marmanis2016}, de radar \cite{chen2014sar, chen2016, sun2012}, hiperespectrais \cite{chen2014, romero2014} e na reconstrução 3D urbana \cite{hane2013, blaha2016, blaha2016towards}. Conforme destacado por \citeonline{zhu2017}, dados de SR representam um novo desafio para DL. Sua natureza de imageamento pode frequentemente diferenciar-se. Por exemplo, dados ópticos, laser e radar fornecem representações diferentes da cena, o que exigiria análises na qual ainda é pouco explorada com o uso de DL. Dados de SR são georeferenciados, porém, imagens da \emph{internet} sem quaisquer metadados de localização, por exemplo, poderiam ser utilizadas para identificação automática de endereços em auxílio à Segurança Pública. Dados de SR carregam consigo uma enorme quantidade de informações, medidas físicas e bioquímicas que, em integração com DL, poderiam melhorar algoritmos de predição ou de emuladores, além de inúmeras outras aplicações. 

The DL as an automatic extractor of urban features is a scientific question of great interest to the community and also covers a limited number of works. The efforts so far, show that there is progress in identifying facade features in specific architectural layouts, with well-defined, symmetrical, and accessible modeling facades. The use of benchmark datasets, such as the ones used in this study, is common and provide a wide overview about the extraction algorithms available today. 

In \citeonline{liu2017deepfacade}, for example, DL is used for the identification of facade features on two online datasets: eTRIMS and ECP datasets, presenting similar results to those shown in this study. The VarCity project \cite{hayko2014}\footnote{Available at https://varcity.ethz.ch/index.html. Accessed \today.}, provides accurate perspective on 3D cities and image-based reconstruction. The research involves not only studies in \textquotedblleft how\textquotedblright~to reconstruct, but how these semantic models could automatically assist to the daily life events (e.g. traffic, pedestrians, vehicles, green areas, among others).
%Tema ainda emergente, o uso de DL na extração automática de feições urbanas voltada às áreas Cartográficas é questão científica de grande interesse da comunidade e, ainda, abrange um número reduzido de trabalhos. Os esforços realizados até o momento, mostram que há progresso sobre a identificação de feições de fachadas em tipos arquitetônicos específicos\cite{vangool2013} (ver Seção \ref{architectural-style}), com fachadas bem definidas, simétricas e de modelagem acessível (i.e. devido aos padrões de repetição entre as edificações). O uso de conjunto para \emph{benchmarks} é comum e fornece um panorama completo quanto aos algoritmos de extração disponíveis hoje. Em \citeonline{liu2017deepfacade}, por exemplo, DL é utilizada para a identificação de feições em fachadas sobre dois conjuntos de dados eTRIMS e ECP (ver Tabela \ref{datasets}). 
